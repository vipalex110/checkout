{{ header }} 
{% if ((settings['step']['login']['option']['guest']['display']) and (facebook_enable or google_enable) ) %} 
 {% set login_boxes_width=31.1 %}
{% else %} 
 {% set login_boxes_width=47.7 %}
{% endif %}



<style>
.close_modal{
position: relative;
left: 550px;
cursor: pointer;
}
.supercheckout_top_boxes{width:{{ login_boxes_width }}%;}
.supercheckout_login_option_box{
    background-color:rgba(7, 8, 5, 0.02) !important
}
div#columnleft-1{
    min-height:auto !important;
}

.progress-bar-grey {
    background: #c5c5c5;
}
.freeShipping h3 {
    font-size: 15px;
    text-align: center;
    margin-top: 20px;
    margin-top: 10px;
    margin-bottom: 15px;
    text-transform: uppercase;

}
.login-form p a {
    font-size: 12px;
    margin-top: 5px;
    margin-bottom: 10px;
}
.freeShipping .progress {
    height: 25px;
    background: #e4e4e4;
}
.freeShipping .progress-bar{
    
    line-height:24px;
}
.form-group.login-options {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-evenly;
}
.form-group.login-options .radio-inline {
    position: relative;
    padding-left: 0;
    display: flex;
    flex: 1 0 auto;
    flex-direction: column;
    margin: 2px !important;
    width: auto;
}
</style>
{% if settings['step']['customizer'] is defined %}
<style>
.progress-bar-success{
    background-color:{{ settings['step']['customizer']['kb_shipping_bar_bg_color'] }} !important;
}

div#confirm_order{
    background: {{ settings['step']['customizer']['kb_button_bg_color'] }} !important;
    color: {{ settings['step']['customizer']['kb_button_text_color'] }} !important;
    border: {% if (settings['step']['customizer']['kb_button_border_color'] is not empty) %}solid {{ settings['step']['customizer']['kb_button_border_color'] }} !important{% endif %};
    border-bottom: {% if (settings['step']['customizer']['kb_border_bottom_color'] is not empty) %}solid {{ settings['step']['customizer']['kb_border_bottom_color'] }} !important{% endif %};
}

div#confirm_order:hover{
    background: {{ settings['step']['customizer']['kb_button_bg_color'] }} !important;
    color: {{ settings['step']['customizer']['kb_button_text_color'] }} !important;
    border: {% if (settings['step']['customizer']['kb_button_border_color'] is not empty) %}solid {{ settings['step']['customizer']['kb_button_border_color'] }} !important{% endif %};
    border-bottom: {% if (settings['step']['customizer']['kb_border_bottom_color'] is not empty) %}solid {{ settings['step']['customizer']['kb_border_bottom_color'] }} !important{% endif %};
}

#button-coupon{
    background:{{ settings['step']['customizer']['kb_coupon_button_bg_color'] }} !important;
    border: 0px solid !important;
}

#button-voucher{
    background:{{ settings['step']['customizer']['kb_voucher_button_bg_color'] }} !important;
    border: 0px solid !important;
}

#supercheckout-fieldset .rectangle-list li:first-child a:before{
    background:{{ settings['step']['customizer']['kb_ac_bg_color'] }} !important;
    border: 0px solid !important;
}

#supercheckout-fieldset .rectangle-list li:first-child a:before:hover{
    background:{{ settings['step']['customizer']['kb_ac_bg_color'] }} !important;
    border: 0px solid !important;
}

#supercheckout-fieldset .rectangle-list li:nth-child(2) a:before{
    background:{{ settings['step']['customizer']['kb_logout_bg_color'] }} !important;
    border: 0px solid !important;
}

input#button-login{
    background:{{ settings['step']['customizer']['kb_login_bg_color'] }} !important;
    border: 0px solid !important;
}

input#button-login:hover{
    background:{{ settings['step']['customizer']['kb_login_bg_color'] }} !important;
}
#display_payment .buttons{
display:none;
}
{{ settings['step']['customizer']['custom_css'] }} 
</style>

<script>
{% if (settings['step']['customizer']['custom_js'] is defined) %} {{ settings['step']['customizer']['custom_js'] }}{% endif %} 
</script>
{% endif %} 
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css" rel="stylesheet" media="screen" />
<link rel="stylesheet" type="text/css" href="catalog/view/theme/{{ default_theme }}/stylesheet/supercheckout-light_new.css" />
<link rel="stylesheet" type="text/css" href="catalog/view/theme/{{ default_theme }}/stylesheet/supercheckout/theme/scripts/plugins/notifications/notyfy/jquery.notyfy.css" />
<link rel="stylesheet" type="text/css" href="catalog/view/theme/{{ default_theme }}/stylesheet/supercheckout/theme/scripts/plugins/notifications/notyfy/themes/default.css" />
<link rel="stylesheet" type="text/css" href="catalog/view/theme/{{ default_theme }}/stylesheet/supercheckout/theme/scripts/plugins/notifications/Gritter/css/jquery.gritter.css" />
<link rel="stylesheet" type="text/css" href="catalog/view/theme/{{ default_theme }}/stylesheet/supercheckout/colorbox.css" />

<style>
 {% if (settings['custom']['style'] is defined) %} {{ settings['custom']['style'] }}{% endif %}  
    #progressbar .ui-progressbar-value{
        height: 2px;
    }
</style>

<div id="fb-root"></div>
<div class="container opc-container">
    <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %} 
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %} 
    </ul>
    <div id="content">
    {% if (settings['step']['html_value']['value']['header'] is defined and settings['step']['html_value']['value']['header'] != "") %} 
                <div id="supercheckout_html_content_header">        
                    {{ ( settings['step']['html_value']['value']['header']) }} 
                </div>
    {% endif %} 
    
    
    <div class="freeShipping">
        
    </div>
                            
    <fieldset class="group-select" id="supercheckout-fieldset">
        <div id="form_disable" style="background:#e0ffbb; opacity:0.1; z-index:99999; position: absolute; display:none;"></div>
        <div class="supercheckout-threecolumns supercheckout-container supercheckout-skin-generic " id="supercheckout-columnleft">
            <div class="row"> 
                
 {% if (settings['general']['layout'] == '3-Column') %}
 {% set layout_name='three-column' %}
 {% set multiplier=1 %}
 {% elseif (settings['general']['layout'] == '2-Column') %}
 {% set layout_name='two-column' %}
 {% set multiplier=1 %}
 {% elseif (settings['general']['layout'] == '1-Column') %}
 {% set layout_name='one-column' %}
 {% set multiplier=1 %}
 {% endif %}

 
                <div class="col-lg-4 col-md-4 col-sm-12" style="width:{% set i= settings['general']['column_width'][layout_name][1]*multiplier %} {{ i }}%">
                    <div class="supercheckout-column-left columnleftsort custom-panel" id="columnleft-1"> 
                        <div  class="supercheckout-blocks" data-column="{{ sort_block['login'][layout_name]['column'] }}" data-row="{{ sort_block['login'][layout_name]['row'] }}" data-column-inside="{{ sort_block['login'][layout_name]['column-inside'] }}"  >
	<h2 class="title section-title">
		{% if (not logged) %} {{ text_login_option }} {% else %} {{ text_welcome~ ' '~firstName~ ' '~lastName }}{% endif %} 
		<i class="fa fa-user"></i>
	</h2>
	
	


  <div id="checkoutBillingAddress">
                                        {% if (addresses) %} 
                                                <div class="supercheckout-checkout-content">
                                                </div>
                                                <ul>
                                                        <li>
                                                                <div class="supercheckout-extra-wrap radio">
                                                                        <input type="radio" name="payment_address" value="existing" id="payment-address-existing" checked="checked" style="height:10px;" />
                                                                        <label for="payment-address-existing">{{ text_address_existing_new }}</label>
                                                                </div>    
                                                                <div id="payment-existing">
                                                                        <select name="address_id" id="payment_address_id_custom" class="form-control" >
                                                                                {% for address in addresses %} 
                                                                                {% if (address['address_id'] == address_id) %} 
                                                                                <option value="{{ address['address_id'] }}" selected="selected">{{ address['firstname'] }} {{ address['lastname'] }}, {{ address['address_1'] }}, {{ address['city'] }}, {{ address['zone'] }}, {{ address['country'] }}</option>
                                                                                {% set selected_payment_address = address['firstname']~" "~ address['lastname']~"<br>"~ address['address_1']~"<br> "~ address['city']~"<br> "~ address['zone']~"<br>"~ address['country'] %} 
                                                                                {% else %} 
                                                                                <option value="{{ address['address_id'] }}">{{ address['firstname'] }} {{ address['lastname'] }}, {{ address['address_1'] }}, {{ address['city'] }}, {{ address['zone'] }}, {{ address['country'] }}</option>
                                                                                {% endif %} 
                                                                                {% endfor %} 
                                                                        </select>
                                                                        <div style="margin-top: 10px;" id="payment_address_detail" class="supercheckout_address_detail card userAddressData">{{ selected_payment_address }}</div>
                                                                </div>
                                                        </li>
                                                        <li>
                                                                <div class="supercheckout-extra-wrap radio">
                                                                        <p>
                                                                                <input type="radio" name="payment_address" value="new" id="payment-address-new" style="height:10px;"/>
                                                                                <label for="payment-address-new">{{ text_address_new_new }}</label>
                                                                        </p>
                                                                </div>
                                                        </li>
                                                </ul>
                                        {% endif %} 

                                        <div id="payment-new" style="display: {{ addresses ? 'none' : 'block' }};">
                                                <div id="payment_address_table" class="supercheckout-form">
                                                        <div>
                                                        {% if (logged) %} 
                                                                {% if (payment_address_sort_order['fields']['firstname']['sort_order'] - payment_address_sort_order['fields']['lastname']['sort_order'] == -1 and settings['option']['logged']['payment_address']['fields']['firstname']['display'] and settings['option']['logged']['payment_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['firstname']['sort_order'] }}" > 
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %} {{ order_details['payment_firstname'] }} {% endif %}"  class="form-control supercheckout-large-field" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6"> 
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %} {{ order_details['payment_lastname'] }} {% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>

                                                                </div>
                                                                {% elseif (payment_address_sort_order['fields']['firstname']['sort_order'] - payment_address_sort_order['fields']['lastname']['sort_order'] == 1 and settings['option']['logged']['payment_address']['fields']['firstname']['display'] and settings['option']['logged']['payment_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['lastname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                        <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %} {{ order_details['payment_lastname'] }} {% endif %}" class="supercheckout-large-field form-control" />

                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %}{{ order_details['payment_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>


                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['payment_address']['fields']['firstname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                        <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %}{{ order_details['payment_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['payment_address']['fields']['lastname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['lastname']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                        <span style="display:{% if (settings['option']['logged']['payment_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %}{{ order_details['payment_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (payment_address_sort_order['fields']['firstname']['sort_order'] - payment_address_sort_order['fields']['lastname']['sort_order'] == -1 and settings['option']['guest']['payment_address']['fields']['firstname']['display'] and settings['option']['guest']['payment_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %}{{ order_details['payment_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %}{{ order_details['payment_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif ( payment_address_sort_order['fields']['firstname']['sort_order'] - payment_address_sort_order['fields']['lastname']['sort_order'] == 1 and settings['option']['guest']['payment_address']['fields']['firstname']['display'] and settings['option']['guest']['payment_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['lastname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">            
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %}{{ order_details['payment_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %}{{ order_details['payment_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['payment_address']['fields']['firstname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                        <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="firstname" value="{% if (order_details['payment_firstname'] is defined) %}{{ order_details['payment_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['payment_address']['fields']['lastname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['lastname']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                        <span style="display:{% if (settings['option']['guest']['payment_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="lastname" value="{% if (order_details['payment_lastname'] is defined) %}{{ order_details['payment_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['telephone']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['telephone']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['telephone']['sort_order'] }}">
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="telephone">{{ entry_telephone }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['telephone']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['telephone']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                        </label>
                                                                        <input type="text" name="telephone" value="{% if (order_details['telephone'] is defined) %}{{ order_details['telephone'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                </div>
                                                        </div>
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['company']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['company']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['company']['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="company">{{ entry_company }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['company']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['company']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                        </label>
                                                                        <input type="text" name="company" value="{% if (order_details['payment_company'] is defined) %}{{ order_details['payment_company'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                </div>
                                                        </div>

                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['address_1']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['address_1']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['address_1']['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="address_1">{{ entry_address_1 }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['address_1']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['address_1']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                        </label>
                                                                        <input type="text" name="address_1" value="{% if (order_details['payment_address_1'] is defined) %}{{ order_details['payment_address_1'] }}{% endif %}" class="supercheckout-large-field form-control" id="address_1"/>
                                                                </div>
                                                        </div>
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['address_2']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['address_2']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['address_2']['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="address_2"> {{ entry_address_2 }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['address_2']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['address_2']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                        </label>
                                                                        <input type="text" name="address_2" value="{% if (order_details['payment_address_2'] is defined) %}{{ order_details['payment_address_2'] }}{% endif %}" class="supercheckout-large-field form-control" id="address_2"/>
                                                                </div>
                                                        </div>
                                                        {% if (logged) %} 
                                                                {% if (payment_address_sort_order['fields']['postcode']['sort_order'] - payment_address_sort_order['fields']['city']['sort_order'] == -1 and settings['option']['logged']['payment_address']['fields']['postcode']['display'] and settings['option']['logged']['payment_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['postcode']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">            
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif (payment_address_sort_order['fields']['postcode']['sort_order'] - payment_address_sort_order['fields']['city']['sort_order'] == 1 and settings['option']['logged']['payment_address']['fields']['postcode']['display'] and settings['option']['logged']['payment_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">    
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['payment_address']['fields']['city']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="city">{{ entry_city }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['payment_address']['fields']['postcode']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['postcode']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (payment_address_sort_order['fields']['postcode']['sort_order'] - payment_address_sort_order['fields']['city']['sort_order'] == -1 and settings['option']['guest']['payment_address']['fields']['postcode']['display'] and settings['option']['guest']['payment_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['postcode']['sort_order'] }}" >
                                                                   <div class="col-sm-6">
                                                                           <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif ( payment_address_sort_order['fields']['postcode']['sort_order'] - payment_address_sort_order['fields']['city']['sort_order'] == 1 and settings['option']['guest']['payment_address']['fields']['postcode']['display'] and settings['option']['guest']['payment_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />

                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>           
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['payment_address']['fields']['city']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="city">{{ entry_city }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="city" value="{% if (order_details['payment_city'] is defined) %}{{ order_details['payment_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['payment_address']['fields']['postcode']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['postcode']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="payment-postcode-required" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %} 

                                                        {% for custom_field in custom_fields %} 
                                                        {% if (custom_field['location'] == 'address') %} 
                                                        {% if (custom_field['type'] == 'select') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <select name="custom_field[{{ custom_field['custom_field_id'] }}]" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field  form-control">
                                                                          <option value="">{{ text_select }}</option>
                                                                          {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                          <option value="{{ custom_field_value['custom_field_value_id'] }}">{{ custom_field_value['name'] }}</option>
                                                                          {% endfor %} 
                                                                    </select>
                                                          </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'radio') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span><br><br>
                                                                    </label>
                                                                        {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                    <div style="position: relative;">
                                                                    <input type="radio" name="custom_field[{{ custom_field['custom_field_id'] }}]" id="{{ custom_field['custom_field_id'] }}_{{ custom_field['name'] }}" value="{{ custom_field_value['custom_field_value_id'] }}" class="" />
                                                                        <label for="{{ custom_field['custom_field_id'] }}_{{ custom_field['name'] }}">
                                                                                {{ custom_field_value['name'] }}
                                                                        </label>
                                                                    </div>
                                                                        {% endfor %} 
                                                                        
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'checkbox') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                    <div style="position:relative;">
                                                                    <input type="checkbox" name="custom_field[{{ custom_field['custom_field_id'] }}][]" value="{{ custom_field_value['custom_field_value_id'] }}" />
                                                                        <label>
                                                                          
                                                                          {{ custom_field_value['name'] }} 
                                                                        </label>
                                                                    </div>
                                                                        {% endfor %} 
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'text') %} 
 
                                                        <div class="sort_data custom-field custom_field_testing" style="display:
 {% if (logged) %} 
 {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display'] == 1) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control" />
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'textarea') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                        <textarea name="custom_field[{{ custom_field['custom_field_id'] }}]" style="width: 100%" rows="3" placeholder="{{ custom_field['name'] }}" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control">{{ custom_field['value'] }}</textarea>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'file') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                        <button type="button" id="button-payment-custom-field{{ custom_field['custom_field_id'] }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>
                                                                        <input type="hidden" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" />
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'date') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <div class="input-group date">
                                                                        <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="YYYY-MM-DD" readonly="" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="form-control" />
                                                                        <span class="input-group-btn">
                                                                        <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'time') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                        <div class="input-group time">
                                                                                <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" readonly="" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="HH:mm" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="form-control" />
                                                                                <span class="input-group-btn">
                                                                                <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                                </span>
                                                                        </div>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'datetime') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][field]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ payment_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                        <div class="input-group datetime">
                                                                                <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" readonly="" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="YYYY-MM-DD HH:mm" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="form-control" />
                                                                                <span class="input-group-btn">
                                                                                <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                                </span>
                                                                        </div>
                                                          </div>
                                                        </div>
                                                        {% endif %} 

                                                        {% endif %} 
                                                        {% endfor %} 

                                                        {% if (logged) %} 
                                                                {% if (payment_address_sort_order['fields']['zone_id']['sort_order'] - payment_address_sort_order['fields']['country_id']['sort_order'] == -1 and settings['option']['logged']['payment_address']['fields']['country_id']['display'] and settings['option']['logged']['payment_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                    <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %}                                        
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}" selected="selected">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif (payment_address_sort_order['fields']['zone_id']['sort_order'] - payment_address_sort_order['fields']['country_id']['sort_order'] == 1 and settings['option']['logged']['payment_address']['fields']['country_id']['display'] and settings['option']['logged']['payment_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %}                                        
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}" selected="selected">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="country">{{ entry_country }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="country_id" class="supercheckout-large-field form-control">
                                                                                        <option value="">{{ text_select }}</option>
                                                                                        {% for country in countries %}                                        
                                                                                        {% if ((country['country_id'] == country_id)) %} 
                                                                                        <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% else %} 
                                                                                        <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% endif %} 
                                                                                        {% endfor %} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                        {{ zones_default }} 
                                                                                </select>
                                                                        </div> 

                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (payment_address_sort_order['fields']['zone_id']['sort_order'] - payment_address_sort_order['fields']['country_id']['sort_order'] == -1 and settings['option']['guest']['payment_address']['fields']['country_id']['display'] and settings['option']['guest']['payment_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %}                                        
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif ( payment_address_sort_order['fields']['zone_id']['sort_order'] - payment_address_sort_order['fields']['country_id']['sort_order'] == 1 and settings['option']['guest']['payment_address']['fields']['country_id']['display'] and settings['option']['guest']['payment_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ payment_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %}                                        
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ payment_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="country">{{ entry_country }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="country_id" class="supercheckout-large-field form-control">
                                                                                        <option value="">{{ text_select }}</option>
                                                                                        {% for country in countries %}                                        
                                                                                        {% if ((country['country_id'] == country_id)) %} 
                                                                                        <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% else %} 
                                                                                        <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% endif %} 
                                                                                        {% endfor %} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %} 
                                                        </div>
                                                </div>


                                                <div id="supercheckout_update_address_button_payment" style="text-align: center;display: none;">
                                                        <input type="button" value="{{ address_save_text }}" id="supercheckout_update_address_payment" class="button-save-address orangebuttonsmall">
                                                        <input type="button" value="{{ address_cancel_text }}" id="supercheckout_cancel_address_payment" onclick="cancelSaveAddress('payment-new');" class="button-save-address orangebuttonsmall">
                                                </div>

                                        </div>
                                        <ul>
                                                <li>
                                                        <div class="input-box input-different-shipping" style="display:{% if (not logged) %} {% if (settings['option']['guest']['payment_address']['fields']['shipping']['display']) %} {{ 'block' }} {% else %} {{ 'none' }} {% endif %} {% else %} {% if (settings['option']['logged']['payment_address']['fields']['shipping']['display']) %} {{ 'block' }} {% else %} {{ 'none' }} {% endif %} {% endif %};">
                                                                {% set checked_var='' %} {% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['shipping']['display'] is defined and settings['option']['logged']['payment_address']['fields']['shipping']['checked'] == "1") %} {% set checked_var='checked="checked"' %} {% endif %}{% else %} {% if (settings['option']['guest']['payment_address']['fields']['shipping']['display'] is defined and settings['option']['guest']['payment_address']['fields']['shipping']['checked'] == "1") %} {% set checked_var='checked="checked"' %} {% endif %} {% endif %}
                                                                <input name="use_for_shipping" id="shipping_use" {{ checked_var }} type="checkbox" style="height:10px;">
                                                                {# } else { #}
                                                                <!--<input name="use_for_shipping" id="shipping_use" type="checkbox">-->
                                                                {# } #}
                                                                <label for="shipping_use"><b>{{ text_ship_same_address }}</b></label>
                                                        </div>
                                                </li>
                                        </ul>
                                </div>


	
<!-- LOGIN AND EXTRA GIELDS START -->
	
	
	
	
	
	
	<div id="checkoutLogin">
    <div class="supercheckout-checkout-content"></div>
    
    {% if (not logged) %} 
        
        <!-- Оставляем только опцию 'guest' -->
        <div class="form-group login-options">
            <div class="radio-inline">
                <input type="radio" name="account" value="guest" id="guest" checked="checked" />
                <label>{{ text_guest_new }}</label>
            </div>
        </div>

        <!-- Поле для ввода email для гостевой регистрации -->
        <div class="supercheckout-extra-wrap">
            <label class="control-label" for="email">{{ entry_email }}</label>
            <input type="text" id="email" name="email" value="" class="supercheckout-large-field form-control" placeholder="{{ entry_email }}" style="width:100% !important"/>
        </div>

        <!-- Дополнительные поля, если они требуются для гостевой регистрации -->
        <div id="supercheckout-guest-fields" style="padding-bottom: 10px;">
            <input id="use_password" type="hidden" name="use_password" value="0" >
            
            <!-- Пользовательские поля, если они есть -->
            {% for custom_field in custom_fields %}
                {% if (custom_field['location'] == 'account') %}
                    {% if (custom_field['type'] == 'text') %}
                        <div class="supercheckout-extra-wrap custom-field" id="custom-field{{ custom_field['custom_field_id'] }}">
                            <span class="supercheckout-login-label"><b>{{ custom_field['name'] }}<span style="display:{% if (custom_field['required'] == 1) %} inline{% else %} none{% endif %};" class="supercheckout-required">*</span></b></span><br/>
                            <span class="supercheckout-login-value">
                                <input type="text" name="custom_field[{{ custom_field['location'] }}][{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field account_custom_field" data="{% if (custom_field['required'] == 1) %} required{% else %} ''{% endif %}" />
                            </span>
                            <p style="color:red;" class="required_field{{ custom_field['custom_field_id'] }}"></p>
                        </div>
                    {% endif %}
                    
                    {% if (custom_field['type'] == 'select') %}
                        <div class="supercheckout-extra-wrap custom-field" id="custom-field{{ custom_field['custom_field_id'] }}">
                            <b>{{ custom_field['name'] }}</b>
                            <span style="display:{% if (custom_field['required'] == 1) %} inline{% else %} none{% endif %};" class="supercheckout-required">*</span>
                            <select name="custom_field[{{ custom_field['location'] }}][{{ custom_field['custom_field_id'] }}]" id="input-payment-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field account_custom_field">
                                <option value="">{{ text_select }}</option>
                                {% for custom_field_value in custom_field['custom_field_value'] %}
                                    <option value="{{ custom_field_value['custom_field_value_id'] }}">{{ custom_field_value['name'] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>

        <div class="supercheckout-clear"></div>

    {% else %} 
        <div class="myaccount">
            <ol class="rectangle-list">                            
                <li>
                    <a href="{{ myAccount }}">{{ text_my_account }}</a>
                </li>
                <li>
                    <a href="{{ logoutLink }}">{{ text_logout }}</a>
                </li>
                <div class="supercheckout-clear"></div>
            </ol>
        </div>
    {% endif %} 
</div>

	
	
	
	
	

	
<!-- LOGIN AND EXTRA GIELDS END -->





	
	

	{% if (not logged) %} 
            {% if (customer_groups is defined) %} 
                    <div class="customer_group" id="customer_group_div">
                    <label style="display:{% if customer_groups|length > 1 %}{{ 'block !important' }} {% else %} {{ 'none !important' }}{% endif %}"><b>{{ text_customer_groups }}</b></label>
                     {% for all_groups in customer_groups %} 
                        <div class="supercheckout-extra-wrap" style="display:{% if customer_groups|length > 1 %}{{ 'block !important' }} {% else %} {{ 'none !important' }}{% endif %}">
                            <label for="customer_group">
                                <input type="radio" name="customer_group_id" value="{{ all_groups['customer_group_id'] }}" id="customer-groups{{ all_groups['customer_group_id'] }}" class="actual_radio_button"/>
                                <b>{{ all_groups['name'] }}</b>
                            </label>
                            <br />
                        </div><br>
                     {% endfor %} 
                    
		</div>
            {% endif %} 
	{% endif %} 
</div>

                        <div  class="supercheckout-blocks"  data-column="{{ sort_block['payment_address'][layout_name]['column'] }}" data-row="{{ sort_block['payment_address'][layout_name]['row'] }}" data-column-inside="{{ sort_block['payment_address'][layout_name]['column-inside'] }}">
                                <h2 class="supercheckout-numbers supercheckout-numbers-2">{{ text_billing_address }}<i class="fa fa-envelope"></i></h2>




<!-- FIRST NAME PAYMENT START -->





 



<!-- FIRST NAME PAYMENT END -->


                           
                                <br/>
                        </div>    

                        <div class="supercheckout-blocks" data-column="{{ sort_block['shipping_address'][layout_name]['column'] }}" data-row="{{ sort_block['shipping_address'][layout_name]['row'] }}" data-column-inside="{{ sort_block['shipping_address'][layout_name]['column-inside'] }}">
                                <div id="checkoutShippingAddress" {% if (logged) %} {% if (settings['option']['logged']['payment_address']['fields']['shipping']['display'] is defined and settings['option']['logged']['payment_address']['fields']['shipping']['checked'] == "0") %} {{ 'style="display: block"' }} {% else %} {{ 'style="display: none"' }} {% endif %} {% else %} {% if (settings['option']['guest']['payment_address']['fields']['shipping']['display'] is defined and settings['option']['guest']['payment_address']['fields']['shipping']['checked'] == "0") %} {{ 'style="display: block"' }} {% else %} {{ 'style="display: none"' }} {% endif %} {% endif %}>
                                        <div class="supercheckout-checkout-content">
                                        </div>
                                        <ul>
                                                <li>
                                                        <h2 class="supercheckout-numbers supercheckout-numbers-ship">{{ text_shipping_address }}<i class="fa fa-envelope"></i></h2>
                                                </li>
                                        </ul>
                                        {% if (addresses) %} 
                                        <ul>
                                                <li>
                                                        <div class="supercheckout-extra-wrap">
                                                                <input type="radio" name="shipping_address" value="existing" id="shipping-address-existing" checked="checked" style="height:10px;" />
                                                                <label for="shipping-address-existing">{{ text_address_existing_new }}</label>
                                                        </div>
                                                        <div id="shipping-existing" class="styled-select">
                                                                <select name="address_id" id="shipping_address_id_custom" class="form-control" >
                                                                        {% for address in addresses %} 
                                                                        {% if (address['address_id'] == ship_address_id) %} 
                                                                        <option value="{{ address['address_id'] }}" selected="selected">{{ address['firstname'] }} {{ address['lastname'] }}, {{ address['address_1'] }}, {{ address['city'] }}, {{ address['zone'] }}, {{ address['country'] }}</option>
                                                                        {% set selected_shipping_address = address['firstname']~" "~ address['lastname']~"<br>"~ address['address_1']~"<br> "~ address['city']~"<br> "~ address['zone']~"<br>"~ address['country'] %} 
                                                                        {% else %} 
                                                                        <option value="{{ address['address_id'] }}">{{ address['firstname'] }} {{ address['lastname'] }}, {{ address['address_1'] }}, {{ address['city'] }}, {{ address['zone'] }}, {{ address['country'] }}</option>
                                                                        {% endif %} 
                                                                        {% endfor %} 
                                                                </select>
                                                                
                                                            <div  style="margin-top: 10px;" id="shipping_address_detail" class="supercheckout_address_detail card userAddressData">{{ selected_shipping_address }}</div>
                                                        </div>
                                                </li>
                                                <li>
                                                        <div class="supercheckout-extra-wrap">
                                                                <p>
                                                                        <input type="radio" name="shipping_address" value="new" id="shipping-address-new" style="height:10px;" />
                                                                        <label for="shipping-address-new">{{ text_address_new_new }}</label>
                                                                </p>
                                                        </div>
                                                </li>
                                        {% endif %} 
                                        <div id="shipping-new"style="display: {{ addresses ? 'none' : 'block' }};">
                                                <div class="supercheckout-form" id="shipping_address_table">
                                                        {% if (logged) %} 
                                                                {% if (shipping_address_sort_order['fields']['firstname']['sort_order'] - shipping_address_sort_order['fields']['lastname']['sort_order'] == -1 and settings['option']['logged']['shipping_address']['fields']['firstname']['display'] and settings['option']['logged']['shipping_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %}{{ order_details['shipping_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif (shipping_address_sort_order['fields']['firstname']['sort_order'] - shipping_address_sort_order['fields']['lastname']['sort_order'] == 1 and settings['option']['logged']['shipping_address']['fields']['firstname']['display'] and settings['option']['logged']['shipping_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['lastname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group "> 
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %}{{ order_details['shipping_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['shipping_address']['fields']['firstname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['shipping_address']['fields']['lastname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['lastname']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %}{{ order_details['shipping_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (shipping_address_sort_order['fields']['firstname']['sort_order'] - shipping_address_sort_order['fields']['lastname']['sort_order'] == -1 and settings['option']['guest']['shipping_address']['fields']['firstname']['display'] and settings['option']['guest']['shipping_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %}{{ order_details['shipping_lastname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif ( shipping_address_sort_order['fields']['firstname']['sort_order'] - shipping_address_sort_order['fields']['lastname']['sort_order'] == 1 and settings['option']['guest']['shipping_address']['fields']['firstname']['display'] and settings['option']['guest']['shipping_address']['fields']['lastname']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['lastname']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %} {{ order_details['shipping_lastname'] }} {% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                                </div>  
                                                                        </div>  
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['shipping_address']['fields']['firstname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields']['firstname']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="firstname">{{ entry_firstname }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['firstname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="firstname" value="{% if (order_details['shipping_firstname'] is defined) %}{{ order_details['shipping_firstname'] }}{% endif %}"  class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['shipping_address']['fields']['lastname']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['lastname']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="lastname">{{ entry_lastname }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['lastname']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="lastname" value="{% if (order_details['shipping_lastname'] is defined) %}{{ order_details['shipping_lastname'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %}                           
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['address_1']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['address_1']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['address_1']['sort_order'] }}">
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="address_1">{{ entry_address_1 }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['address_1']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['address_1']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span> 
                                                                        </label>
                                                                        <input type="text" name="address_1" value="{% if (order_details['shipping_address_1'] is defined) %}{{ order_details['shipping_address_1'] }}{% endif %}" class="supercheckout-large-field form-control" id="shipping_address_1"/>
                                                                </div>
                                                        </div>
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['address_2']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['address_2']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['address_2']['sort_order'] }}">
                                                                <div class="form-group ">
                                                                        <label class="control-label" for="address_2">{{ entry_address_2 }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['address_2']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['address_2']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                        </label>
                                                                        <input type="text" name="address_2" value="{% if (order_details['shipping_address_2'] is defined) %}{{ order_details['shipping_address_2'] }}{% endif %}" class="supercheckout-large-field form-control" id="shipping_address_2"/>
                                                                </div>
                                                        </div>
                                                        <!--BOC added for adding company name in shipping address by Shashank Agarwal on 13-07-2020-->
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['company']['display']) %} {{ 'block' }} {% else %} {{ 'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['company']['display']) %} {{ 'block' }} {% else %} {{ 'none' }} {% endif %}{% endif %}" data-percentage=" {{ shipping_address_sort_order['fields']['company']['sort_order'] }}" >
                                                                <div class="form-group ">
                                                                    <label class="control-label" for="company">{{ entry_company }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['company']['require']) %} {{ 'inline' }} {% else %} {{ 'none' }} {% endif %}{% else %} {% if (settings['option']['guest']['shipping_address']['fields']['company']['require']) %} {{ 'inline' }} {% else %} {{ 'none' }}{% endif %}{% endif %}" class="supercheckout-required">*</span></label>
                                                                        <input type="text" name="company" value="{% if (order_details['shipping_company'] is defined) %}{{ order_details['shipping_company'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                </div>
                                                        </div>
                                                        <!--EOC added for adding company name in shipping address by Shashank Agarwal on 13-07-2020-->
                                                        
                                                        {% if (logged) %} 
                                                                {% if (shipping_address_sort_order['fields']['postcode']['sort_order'] - shipping_address_sort_order['fields']['city']['sort_order'] == -1 and settings['option']['logged']['shipping_address']['fields']['postcode']['display'] and settings['option']['logged']['shipping_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['postcode']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %}{{ order_details['shipping_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif (shipping_address_sort_order['fields']['postcode']['sort_order'] - shipping_address_sort_order['fields']['city']['sort_order'] == 1 and settings['option']['logged']['shipping_address']['fields']['postcode']['display'] and settings['option']['logged']['shipping_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %}{{ order_details['shipping_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['shipping_address']['fields']['city']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="city">{{ entry_city }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %}{{ order_details['shipping_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['logged']['shipping_address']['fields']['postcode']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['postcode']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (shipping_address_sort_order['fields']['postcode']['sort_order'] - shipping_address_sort_order['fields']['city']['sort_order'] == -1 and settings['option']['guest']['shipping_address']['fields']['postcode']['display'] and settings['option']['guest']['shipping_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['postcode']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %} {{ order_details['shipping_city'] }} {% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>  
                                                                </div>
                                                                {% elseif ( shipping_address_sort_order['fields']['postcode']['sort_order'] - shipping_address_sort_order['fields']['city']['sort_order'] == 1 and settings['option']['guest']['shipping_address']['fields']['postcode']['display'] and settings['option']['guest']['shipping_address']['fields']['city']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="city">{{ entry_city }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %} {{ order_details['shipping_city'] }} {% endif %}" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                        </label>
                                                                                        <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['shipping_address']['fields']['city']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields']['city']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="city">{{ entry_city }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['city']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="city" value="{% if (order_details['shipping_city'] is defined) %}{{ order_details['shipping_city'] }}{% endif %}" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (settings['option']['guest']['shipping_address']['fields']['postcode']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['postcode']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="postcode">{{ entry_postcode }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['postcode']['require'] and country_info_guest['postcode_required']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" id="shipping-postcode-required" class="supercheckout-required">*</span>
                                                                                </label>
                                                                                <input type="text" name="postcode" value="" class="supercheckout-large-field form-control" />
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %} 

                                                        {% for custom_field in custom_fields %} 
                                                        {% if (custom_field['location'] == 'address') %} 
                                                        {% if (custom_field['type'] == 'select') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                            <div class="form-group "> 
                                                                <label class="control-label">{{ custom_field['name'] }} 
                                                                    <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                </label>
                                                                <select name="custom_field[{{ custom_field['custom_field_id'] }}]" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control">
                                                                  <option value="">{{ text_select }}</option>
                                                                  {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                  <option value="{{ custom_field_value['custom_field_value_id'] }}">{{ custom_field_value['name'] }}</option>
                                                                  {% endfor %} 
                                                                </select>
                                                            </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'radio') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span><br><br>
                                                                    </label>
                                                                    {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                        <input type="radio" name="custom_field[{{ custom_field['custom_field_id'] }}]" id="{{ field }}_{{ value['name'] }}" value="{{ custom_field_value['custom_field_value_id'] }}" class="" />
                                                                        <label for="{{ custom_field['custom_field_id'] }}_{{ custom_field['name'] }}">
                                                                                {{ custom_field_value['name'] }}
                                                                        </label>
                                                                        <br>
                                                                        <br>
                                                                        {% endfor %} 
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'checkbox') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span><br><br>
                                                                    </label>
                                                                    {% for custom_field_value in custom_field['custom_field_value'] %} 
                                                                        <label>
                                                                          <input type="checkbox" name="custom_field[{{ custom_field['custom_field_id'] }}][]" value="{{ custom_field_value['custom_field_value_id'] }}" />
                                                                          {{ custom_field_value['name'] }} 
                                                                        </label>
                                                                        {% endfor %} 
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        
 {% if (custom_field['type'] == 'text') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="shipping_custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control" />
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'textarea') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">  
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <textarea name="custom_field[{{ custom_field['custom_field_id'] }}]"  style="width: 100%" rows="3" placeholder="{{ custom_field['name'] }}" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control">{{ custom_field['value'] }}</textarea>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'file') %} 
                                                        <div class="sort_data custom-field" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" id="custom-field{{ custom_field['custom_field_id'] }}">
                                                                <div class="form-group ">  
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <button type="button" id="button-payment-custom-field{{ custom_field['custom_field_id'] }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>
                                                                    <input type="hidden" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" />
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'date') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group ">  
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <div class="input-group date">
                                                                          <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="YYYY-MM-DD" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field" />
                                                                          <span class="input-group-btn">
                                                                          <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                          </span>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'time') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group ">  
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                    <div class="input-group time">
                                                                            <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="HH:mm" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field form-control" />
                                                                            <span class="input-group-btn">
                                                                            <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                            </span>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% if (custom_field['type'] == 'datetime') %} 
                                                        <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][field]['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};"  data-percentage="{{ shipping_address_sort_order['fields'][custom_field['custom_field_id']]['sort_order'] }}" >
                                                                <div class="form-group "> 
                                                                    <label class="control-label">{{ custom_field['name'] }} 
                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span>
                                                                    </label>
                                                                        <div class="input-group datetime">
                                                                                <input type="text" name="custom_field[{{ custom_field['custom_field_id'] }}]" value="{{ custom_field['value'] }}" placeholder="{{ custom_field['name'] }}" data-date-format="YYYY-MM-DD HH:mm" id="input-shipping-custom-field{{ custom_field['custom_field_id'] }}" class="supercheckout-large-field" />
                                                                                <span class="input-group-btn">
                                                                                <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                                                                </span>
                                                                        </div>
                                                                </div>
                                                        </div>
                                                        {% endif %} 
                                                        {% endif %} 
                                                        {% endfor %} 
                                                        {% if (logged) %} 
                                                                {% if (shipping_address_sort_order['fields']['zone_id']['sort_order'] - shipping_address_sort_order['fields']['country_id']['sort_order'] == -1 and settings['option']['logged']['shipping_address']['fields']['country_id']['display'] and settings['option']['logged']['shipping_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                    <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %} 
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif (shipping_address_sort_order['fields']['zone_id']['sort_order'] - shipping_address_sort_order['fields']['country_id']['sort_order'] == 1 and settings['option']['logged']['shipping_address']['fields']['country_id']['display'] and settings['option']['logged']['shipping_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                   <div class="col-sm-6">
                                                                           <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %} 
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                    <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="country">{{ entry_country }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="country_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                        <option value="">{{ text_select }}</option>
                                                                                        {% for country in countries %} 
                                                                                        {% if ((country['country_id'] == country_id)) %} 
                                                                                        <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% else %} 
                                                                                        <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% endif %} 
                                                                                        {% endfor %} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                            <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="zone_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                        {{ zones_default }} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                                <!--For not logged in--> 
                                                        {% else %} 
                                                                {% if (shipping_address_sort_order['fields']['zone_id']['sort_order'] - shipping_address_sort_order['fields']['country_id']['sort_order'] == -1 and settings['option']['guest']['shipping_address']['fields']['country_id']['display'] and settings['option']['guest']['shipping_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                    <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %} 
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                                {% elseif ( shipping_address_sort_order['fields']['zone_id']['sort_order'] - shipping_address_sort_order['fields']['country_id']['sort_order'] == 1 and settings['option']['guest']['shipping_address']['fields']['country_id']['display'] and settings['option']['guest']['shipping_address']['fields']['zone_id']['display']) %} 
                                                                <div class="row sort_data"  data-percentage="{{ shipping_address_sort_order['fields']['country_id']['sort_order'] }}" >
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                        <label class="control-label" for="country">{{ entry_country }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="country_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                <option value="">{{ text_select }}</option>
                                                                                                {% for country in countries %} 
                                                                                                {% if ((country['country_id'] == country_id)) %} 
                                                                                                <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% else %} 
                                                                                                <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                                {% endif %} 
                                                                                                {% endfor %} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>
                                                                        <div class="col-sm-6">
                                                                                <div class="form-group ">
                                                                                    <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                        <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                        <select name="zone_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                                {{ zones_default }} 
                                                                                        </select>
                                                                                </div>
                                                                        </div>     
                                                                </div>
                                                                {% else %} 
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['country_id']['sort_order'] }}">
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="country">{{ entry_country }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['country_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="country_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                        <option value="">{{ text_select }}</option>
                                                                                        {% for country in countries %} 
                                                                                        {% if ((country['country_id'] == country_id)) %} 
                                                                                        <option value="{{ country['country_id'] }}" selected="selected" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% else %} 
                                                                                        <option value="{{ country['country_id'] }}" class="{{country['iso_code_2']}}">{{ country['name'] }}</option>
                                                                                        {% endif %} 
                                                                                        {% endfor %} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                <div class="sort_data" style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};" data-percentage="{{ shipping_address_sort_order['fields']['zone_id']['sort_order'] }}" >
                                                                        <div class="form-group ">
                                                                                <label class="control-label" for="zone">{{ entry_zone }} 
                                                                                <span style="display:{% if (logged) %} {% if (settings['option']['logged']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['shipping_address']['fields']['zone_id']['require']) %} {{'inline' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-required">*</span></label>
                                                                                <select name="zone_id" class="supercheckout-large-field form-control" style="opacity: 1 !important;height: 17px;">
                                                                                        {{ zones_default }} 
                                                                                </select>
                                                                        </div>
                                                                </div>
                                                                {% endif %} 
                                                        {% endif %} 

                                                </div>
                                        </div>
                                        </ul>
                                        <div id="supercheckout_update_address_button_shipping" style="text-align: center;display: none;">
                                                <input type="button" value="{{ address_save_text }}" id="supercheckout_update_address_shipping" class="button-save-address orangebuttonsmall">
                                                <input type="button" value="{{ address_cancel_text }}" id="supercheckout_cancel_address_shipping" onclick="cancelSaveAddress('shipping-new');" class="button-save-address orangebuttonsmall">
                                        </div>
                                </div>                   
                        </div>
                        
                        <!--column 2 and 3 start-->
                         <!--shipping block start-->
                        {% if (settings['step']['shipping_method']['display_options'] is defined and settings['step']['shipping_method']['display_options'] == 1) %} 
                            <div  class="supercheckout-blocks" data-column="{{ sort_block['shipping_method'][layout_name]['column'] }}" data-row="{{ sort_block['shipping_method'][layout_name]['row'] }}" data-column-inside="{{ sort_block['shipping_method'][layout_name]['column-inside'] }}" >
                                <div class="opc_shipping_method">
                                    <h2 class="supercheckout-numbers supercheckout-numbers-3">{{ text_shipping_method }}<div class="loader" id="shippingMethodLoader"></div><i class="fa fa-truck"></i></h2>
                                    
                                            
                                    <div id="shipping-method">
                                        {% if (not shipping_required) %} 
                                            <div class="supercheckout-checkout-content" style="display:block">
                                                    <div class="permanent-warning" style="display: block;">No shipping required with these product(s).<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>
                                            </div>
                                        {% endif %} 
                                        {% if (error_warning_shipping) %} 
                                            <div class="supercheckout-checkout-content" style="display:block">
                                                    <div class="warning" style="display: block;">{{ error_warning_shipping }}<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>
                                            </div>
                                        {% endif %} 
                                        <div class="supercheckout-checkout-content">
                                        </div>
                                        {% if (error_warning) %} 
                                            <div class="warning">{{ error_warning }}</div>
                                        {% endif %} 
                                        {% if (shipping_methods is defined and shipping_methods and shipping_required) %} 
                                            {% set all_shipping_code = [] %}
                                             {% for shipping_method in shipping_methods %} 
                                                {% for quote in shipping_method['quote'] %} 
                                                    {% set all_shipping_code = all_shipping_code|merge([quote['code']]) %}
                                                {% endfor %}
                                            {% endfor %}
                                            {% if codeShipping not in all_shipping_code %}
                                                {% set codeShipping='' %}
                                            {% endif %}

                                            {% for key,shipping_method in shipping_methods %} 
                                                {% if (not shipping_method['error']) %} 
                                                                    <li class="highlight">
                                                                            
                                                    {% for quote in shipping_method['quote'] %} 
                                                    {# 
                                                    * Changes added to work radio button properly in case of if a shipping method has multiple options
                                                    * as the html previously were wrong we were using the radio class outside the foreach loop
                                                    * @date 05-06-2024
                                                    * @modifier Pragya Maurya
                                                    * PMMay2024 shipping_method-fixes
                                                    #}
													<div class="radio ">
                                                        <tr class="highlight">
                                                                            {% if (quote['code'] == codeShipping or codeShipping == '' ) %} 
                                                                    {% set codeShipping = quote['code'] %} 
                                                                    <input type="radio" name="shipping_method" value="{{ quote['code'] }}" id="{{ quote['code'] }}" checked="checked" />
                                                                {% else %} 
                                                                    <input type="radio" name="shipping_method" value="{{ quote['code'] }}" id="{{ quote['code'] }}" />
                                                                {% endif %} 


                                                                <label for="{{ quote['code'] }}">
                                                                    {% if (settings['shipping_logo']['default_option'] == 'imageonly' and settings['step']['shipping_method']['logo'][quote['code']] is not empty and shipping_logo[quote['code']]) %} 


                                                                        {{ '<a title="'~quote['title']~'"><img src="image/'~settings['step']['shipping_method']['logo'][quote['code']]~'" alt="'~quote['title']~'" style="max-width: 100px;max-height: 100px" /></a>' }}
                                                                        {{ '<span class="supercheckout-shipping-small-title shippingPrice" style="display: inline;" for="'~quote['code']~'">&nbsp&nbsp'~quote['text']~'</span>' }}
                                                                    {% elseif (settings['shipping_logo']['default_option'] == 'textwithimage' and settings['step']['shipping_method']['logo'][quote['code']] is not empty and shipping_logo[quote['code']]) %}

                                                                        {{ '<a title="'~quote['title']~'"><img src="image/'~settings['step']['shipping_method']['logo'][quote['code']]~'" alt="'~quote['title']~'" style="max-width: 100px;max-height: 100px" /></a><br>' }}
                                                                        {{ quote['title'] }}
                                                                        {{ '<span class="supercheckout-shipping-small-title shippingPrice" style="display: inline;" for="'~quote['code']~'">&nbsp&nbsp'~quote['text']~'</span>' }}
                                                                    {% else %} 
                                                                        {{ quote['title'] }}
                                                                        {{ '<span class="supercheckout-shipping-small-title shippingPrice" style="display: inline;" for="'~quote['code']~'">&nbsp&nbsp'~quote['text']~'</span>' }}
                                                                    {% endif %} 
                                                                </label>
                                                           {% if (settings['step']['shipping_method']['display_title'] is defined and settings['step']['shipping_method']['display_title']) %} 

                                                        <p class="shippingInfo supercheckout-shipping-small-title">{{ settings['step']['shipping_method']['title'][key~'.'~key][language_id] is defined ? settings['step']['shipping_method']['title'][key~'.'~key][language_id] : shipping_method['title'] }}</p>
                                                           
                                                           {% endif %}
                                                           <!--added following closing tag by velsof to fix layout-->
                                                        </tr>
														</div>
                                                    {% endfor %} 

                                                    <!--added following two closing tag by velsof to fix layout-->
                                                    
                                                    </li>
                                                {% else %} 
                                                    <tr>
                                                        <td colspan="3">
                                                            <div class="error">{{ shipping_method['error'] }}</div>
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %} 
                                        <br />
                                        {% endif %} 
                                                     
                                        <!--commented following two closing div tag by velsof to fix layout-->
                                        <!--
                                        </div>      
                                    </div>
                                        -->
                                </div>
                            </div>
                            </div>
                        {% endif %}
                        <!--shipping block end-->
                        <!--payment block start-->
                        {% if (settings['step']['payment_method']['display_options'] == 1) %} 
<div  class="supercheckout-blocks" data-column="{{ sort_block['payment_method'][layout_name]['column'] }}" data-row="{{ sort_block['payment_method'][layout_name]['row'] }}" data-column-inside="{{ sort_block['payment_method'][layout_name]['column-inside'] }}">
                                
                            <h2 class="supercheckout-numbers supercheckout-numbers-4">{{ text_payment_method }}<div class="loader" id="paymentMethodLoader"></div><i class="fa fa-credit-card"></i></h2>
                            <div class="opc_payment_method">	
                                <div id="payment-method">
                                    <div class="supercheckout-checkout-content">
                                    </div>
                                    {% if (error_warning) %} 
                                        <div class="warning">{{ error_warning }}</div>
                                    {% endif %} 
                                    {% if (payment_methods is defined and payment_methods) %}                 
                                        {% set all_payment_code = [] %}
                                        {% for payment_method in payment_methods %} 
                                            {% set all_payment_code = all_payment_code|merge([payment_method['code']]) %}
                                        {% endfor %}
                                        {% if (not (code in all_payment_code)) %}{% set code='' %}{% endif %}
                                        <ul>
                                        {% for payment_method in payment_methods %} 
                                            <li class="highlight" id="{{ payment_method['code'] }}">
                                                    <div class="radio">{% if (payment_method['code'] == code or not code ) %} 
                                                        {% set code = payment_method['code'] %} 
                                                        {% if (settings['payment_logo']['default_option'] == 'textwithimage') %}{{ '<br>' }}{% endif %} 
                                                        <input type="radio" name="payment_method" value="{{ payment_method['code'] }}" id="{{ payment_method['code'] }}"  checked="checked" />
                                                    {% else %} 
                                                        {% if (settings['payment_logo']['default_option'] == 'textwithimage') %}{{ '<br>' }}{% endif %} 
                                                        <input type="radio" name="payment_method" value="{{ payment_method['code'] }}" id="{{ payment_method['code'] }}"  />
                                                    {% endif %}
                                                    <label for="{{ payment_method['code'] }}">

                                                        {% if (settings['payment_logo']['default_option'] == 'imageonly' and settings['step']['payment_method']['logo'][payment_method['code']] is not empty and payment_logo[payment_method['code']]) %} 


                                                            {% if (payment_method['code'] == 'klarna_invoice') %}
                                                                {{ '<a><img src="image/'~settings['step']['payment_method']['logo'][payment_method['code']]~'" style="max-width: 100px;max-height: 100px"/></a>' }}
                                                            {% else %} 
                                                                {{ '<a title="'~payment_method['title']~'"><img src="image/'~settings['step']['payment_method']['logo'][payment_method['code']]~'" alt="'~payment_method['title']~'" style="max-width: 100px;max-height: 100px" /></a>' }}
                                                            {% endif %}

                                                        {% elseif (settings['payment_logo']['default_option'] == 'textwithimage' and settings['step']['payment_method']['logo'][payment_method['code']] is not empty and payment_logo[payment_method['code']]) %}

                                                            {% if (payment_method['code'] == 'klarna_invoice') %}

                                                                {{ '<a><img src="image/'~settings['step']['payment_method']['logo'][payment_method['code']]~'" style="max-width: 100px;max-height: 100px" /></a><br>' }}
                                                                {{ settings['step']['payment_method']['title'][payment_method['code']][language_id] is defined ? settings['step']['payment_method']['title'][payment_method['code']][language_id] : payment_method['title'] }}
                                                            {% else %} 
                                                                {{ '<a title="'~payment_method['title']~'"><img src="image/'~settings['step']['payment_method']['logo'][payment_method['code']]~'" alt="'~payment_method['title']~'" style="max-width: 100px;max-height: 100px" /></a><br>' }}
                                                                {{ settings['step']['payment_method']['title'][payment_method['code']][language_id] is defined ? settings['step']['payment_method']['title'][payment_method['code']][language_id] : payment_method['title'] }}
                                                            {% endif %}
                                                        {% else %} 
                                                            {{ settings['step']['payment_method']['title'][payment_method['code']][language_id] is defined ? settings['step']['payment_method']['title'][payment_method['code']][language_id] : payment_method['title'] }}
                                                        {% endif %}

                                                    </label>
                                                </div>
                                            </li>
                                         {% endfor %}
                                         </ul>
                                    <br />
                                     {% else %} 
                                     {{ '<ul><li><font style="color: red">'~text_shipping_not_available~'</font></ul></li>' }} 
                                    {% endif %} 

                                </div>
                            </div>
                        </div>
                         {% endif %}
                        <!--payment block end-->
						
                        <div class="supercheckout-blocks confirmCheckoutBack" data-column="{{ sort_block['cart'][layout_name]['column'] }}" data-row="{{ sort_block['cart'][layout_name]['row'] }}" data-column-inside="{{ sort_block['cart'][layout_name]['column-inside'] }}" style="display:{% if (logged) %}{% if (settings['option']['logged']['cart']['display']) %}{{' ' }}{% else %}{{'none' }}{% endif %}{% else %}{% if (settings['option']['guest']['cart']['display']) %}{{' ' }}{% else %}{{'none' }}{% endif %}{% endif %};">
                        <div class="opc_shoppingcart custom-panel">
                            <h2 class="supercheckout-numbers supercheckout-check">{{ text_confirm_order }}<div class="loader" id="confirmLoader"></div><i class="fa fa-shopping-cart"></i></i></h2>
                            <div class="loader" id="confirmLoader"></div>
                            
                            <div id="confirmCheckout">
                               <div class="supercheckout-checkout-content"></div>

                                {% if (redirect is not defined) %} 
                                <table class="supercheckout-summary table table-bordered shoppingTable">
                                    <tbody>
                                        {% for product in products %} 
                                        <tr>
                                            <td style="width:100%;display:{% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['name']) %} {{' ' }}{% else %} }} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['name']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-name text-left td-product">

                                                <a {% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['image']) %} {{'data-toggle="popover"' }}{% else %} {{'' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['image']) %} {{'data-toggle="popover"' }}{% else %} {{'' }}{% endif %}{% endif %} data-title="{{ product['name'] }}" data-content="<img src='{{ product['thumb'] }}' />" data-placement="right" href="{{ product['href'] }}">{{ product['name'] }}</a>
                                                {% for option in product['option'] %} 
                                                <br />
                                                &nbsp;<small> - {{ option['name'] }}: {{ option['value'] }}</small>
                                                {% endfor %} 
                                                <br />
                                                &nbsp;<small style="display:{% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['model']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['model']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-model"> - {{ column_model~': '~ product['model'] }} {% if (product['reward'] and logged) %} {{ '<span style="color: #696969 !important;padding-left: 10px;">('~text_rewards_point~product['reward']~')</span>' }}{% endif %}</small>
                                            </td>

                                            <td style="width: 30%;display:{% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['quantity']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['quantity']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-qty supercheckout-product-qty-input">
                                                <div class="input-group">
                                                    <span class="input-group-btn">
                                                        <button type="button" id="{{ product['key'] }}" class="cart_quantity_down qty-btn increase_button quantity-left-minus btn btn-primary btn-number" onclick="updateQuantity(this.id,'minus');" data-type="minus" data-field=""  {% if (product['quantity'] <= 1) %} {{ "disabled" }} {% endif %}>
                                                            <span class="fa fa-chevron-down"></span>
                                                        </button>
                                                    </span>
                                                    <input class="form-control input-number quantitybox" type="text" id="quantity" name="quantity[{{ product['key'] }}]" value="{{ product['quantity'] }}" >
                                                    <span class="input-group-btn">
                                                        <button type="button" id="{{ product['key'] }}" class="cart_quantity_down qty-btn decrease_button quantity-right-plus btn btn-primary btn-number" onclick="updateQuantity(this.id,'plus');" data-type="plus" data-field="">
                                                            <span class="fa fa-chevron-up"></span>
                                                        </button>
                                                    </span>
                                                </div>
                                            </td>
                                            <td style="width: 25%;display:{% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['price']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['price']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-total">{{ product['price'] }}</td>
                                            <td style="width: 25%;display:{% if (logged) %} {% if (settings['option']['logged']['cart']['columns']['total']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['columns']['total']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};" class="supercheckout-total">{{ product['total'] }}</td>
                                            <td style="width: 15%;" class="supercheckout-qty"><a href="javascript://" id="{{ product['key'] }}" onclick="removeProduct(this.id);" class="removeProduct supercheckout-product-delete delete_product"><i class="fa fa-times"></i><div id="{{ product['key'] }}"  title="Delete"></div></a></td>
                                        </tr>
                                        {% endfor %} 
                                        {% for voucher in vouchers %} 
                                        <tr>
                                            <td class="supercheckout-name">{{ voucher['description'] }}</td>
                                            <td class="supercheckout-qty">1</td>
                                            <td class="supercheckout-total">{{ voucher['amount'] }}</td>
                                            <td class="supercheckout-total">{{ voucher['amount'] }}</td>
                                        </tr>
                                        {% endfor %} 
                                    </tbody>
                                </table>
                                <table class="supercheckout-totals table table-bordered totalTable">
                                    <tbody>

                                        {% for datatotals in datatotal %} 
                                         <tr>
                                             <td class="title text-right"><b>{{ datatotals['title'] }} {% if (datatotals['code'] == 'voucher' or datatotals['code'] == 'coupon' or datatotals['code'] == 'reward') %}{{'<a href="javascript://" id="'~datatotals['code']~'" onclick="redeem(this.id);" ><div class="removeProduct"></div></a></td>' }}{% endif %}</b></td>
                                             <td class="value text-right"><span class="price">{{ datatotals['text'] }}</span> </td>                                
                                         </tr>
                                        {% endfor %} 
                                         </tbody>
                                </table>  
                                        <div class="custom-panel rewardsection">
                                        <div class="rewardHeader" style="display:{% if (logged) %} {% if (settings['option']['logged']['cart']['option']['coupon']['display']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['option']['coupon']['display']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};">

                                            <a href="javascript:void(0)" onclick="$('.rewardBody').toggle();">{{ text_coupon_code_question }}</a>
                                        </div>
                                        <div class="rewardBody" style="display:none;">
                                            <div id="supercheckout_voucher_input_row" class="form-group form-coupon">    
                                                <div class="input-group" id="voucher-form">
                                                        <input type="hidden" value="coupon" name="next">
                                                        <input id="coupon_code" name="coupon" type="text" class="voucherText form-control" placeholder="{{ text_coupon_code_new }}" >
                                                        <span class="input-group-btn">
                                                            <button id="button-coupon" onclick="callCoupon();" type="button" data-loading-text="Loading..." class="btn btn-primary orangebuttonapply" style="min-height: 33px;">{{ button_apply }}</button>
                                                        </span>
                                                </div>								
                                            </div>
                                        </div>

                                        <div class="voucherHeader" style="display:{% if (logged) %} {% if (settings['option']['logged']['cart']['option']['voucher']['display']) %} {{' ' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['cart']['option']['voucher']['display']) %} {{' ' }}{% else %} {{'none' }}{% endif %}{% endif %};">
                                            <a href="javascript:void(0)" onclick="$('.voucherBody').toggle();">{{ text_voucher_code_question }}</a>
                                        </div>
                                        <div class="voucherBody" style="display:none;">
                                            <div id="supercheckout_voucher_input_row" class="form-group form-coupon">    
                                                <div class="input-group" id="voucher-form">
                                                    <input  id="voucher_code" name="voucher" type="text" class="voucherText form-control" placeholder="{{ text_voucher_code_new }}" >
                                                    <input type="hidden" value="voucher" name="next">
                                                    <span class="input-group-btn">
                                                        <button id="button-voucher" type="button" onClick="callVoucher();" class="btn btn-primary orangebuttonapply">{{ button_apply }}</button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="display:{% if (logged) %} {% if (settings['option']['logged']['cart']['option']['reward']['display'] and customer_available_points and total_product_points) %} {{ 'block' }}{% endif %}{% endif %} {{ 'none' }};">
                                            <div class="title"><b>{{ text_rewards_point}}</b>{{ '<br>'~text_available_rewards_point~customer_available_points~'<br>'~text_max_rewards_point~total_product_points~')' }}</div>
                                            <div class="value"><input  id="rewards_point" name="rewards" type="text" class="voucherText">
                                                <input type="hidden" value="rewards_point" name="next">
                                               {# echo $customer_available_points.$total_product_points #} <input id="button-reward" type="button" onClick="callReward();" class="orangebuttonapply" value="{{ button_apply }}"> 
                                            </div>
                                        </div>
                                    </div>
                                    <div id="supercheckout-comments" style="display: {% if (logged) %} {% if (settings['option']['logged']['confirm']['fields']['comment']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %} {% else %} {% if (settings['option']['guest']['confirm']['fields']['comment']['display']) %} {{'block' }}{% else %} {{'none' }}{% endif %}{% endif %};">
                                            <b>{{ text_comments }}</b>
                                            <textarea id="supercheckout-comment_order" name="comment" rows="4" ></textarea>
                                            <br />
                                            <br />
                                    </div> 
                    {% endif %} 
                            </div>
                        </div>
                        </div>
                        
                        <!--bank transfer block start-->
                        <div id="payment_display_block"  class="supercheckout-blocks" data-column="{{ sort_block['confirm'][layout_name]['column'] }}" data-row="{{ sort_block['confirm'][layout_name]['row'] }}" data-column-inside="{{ sort_block['confirm'][layout_name]['column-inside'] }}" >
                            
                            <div id="display_payment" style="display: block">
                                    {% if (payment_display is defined) %} 
                                    {{ payment_display }} 
                                    {% endif %} 
                            </div>
                            <div class="supercheckout-checkout-content"> </div>

                            <!-- Newsletter subscription -->
                            <div id="newsletter_checkbox" style="display:none; margin-bottom: 2px;"> 
                                <div class="">
                                    <input id="newsletter" type="checkbox" class="actual_checkbox_button" name="subscribe_newsletter" value="0" />
                                    <p style="vertical-align: middle; display: inline-block; margin: 0px;">{{ subscribe_newsletter }}</p>
                                </div>
                            </div>
                            
                            {% if (text_agree) %}           
                            <div id="supercheckout-agree" style="margin-bottom: 2px; display:{% if (logged) %}{% if (settings['option']['logged']['confirm']['fields']['agree']['display']) %}{{'block' }}{% else %}{{'none' }}{% endif %}{% else %}{% if (settings['option']['guest']['confirm']['fields']['agree']['display']) %}{{'block' }}{% else %}{{'none' }}{% endif %}{% endif %};">
                                <div class="">
                                    {% if (agree) %} 
                                    <input type="checkbox" name="agree" value="1" checked="checked" class="actual_checkbox_button" />
                                    {% else %} 
                                    <input type="checkbox" name="agree" value="1" class="actual_checkbox_button"/>
                                    {% endif %} 
                                    <p for="conditions_to_approve[terms-and-conditions]" style="margin: 0px; display: inline-block;cursor: pointer" data-toggle="modal" data-target="#agree-model">
                                            {{ " "~text_agree }}
                                    </p>
                                </div>
                            </div>                
                            {% endif %} 
                            <div id="supercheckout-privacy-policy" style="display: none; margin-bottom: 2px; ">
                                    <div class="">
                                    <input type="checkbox" name="privacy" value="1" class="actual_checkbox_button" />
                                    <p style="vertical-align: middle;display: inline-block;cursor: pointer; margin: 0px" data-toggle="modal" data-target="#privacy-model">
                                    {{ text_privacy }} 
                                    </p>
                                    </div>
                            </div>
                            <div id="placeorderButton">
                                <div id="buttonWithProgres" style="width:206px;">
                                    <div  id="confirm_order" class="orangebutton" >
                                        {{ button_place_order }} 
                                        <div id="progressbar" style="text-align:center;margin-top: 0px;"></div>
                                    </div>
                                </div>
                            </div>
                    </div>
                    {% for sort_html in sort_block['html'] %} 
                    <div  class="supercheckout-blocks" data-column="{{ sort_html[layout_name]['column'] }}" data-row="{{ sort_html[layout_name]['row'] }}" data-column-inside="{{ sort_html[layout_name]['column-inside'] }}">
                            {% if (sort_html['value'] is defined) %}{{ (sort_html['value'] ) }}{% endif %}                
                    </div>
                    {% endfor %} 
                        <!--bank transfer block end-->
                        
                        <!--column 2 and 3 end-->
                        
                    </div>
                     
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12" style="width:{% set i= settings['general']['column_width'][layout_name][2]*multiplier %}{{ i }}%;margin-right:0px;">
                    <div class="supercheckout-column-middle columnleftsort custom-panel" id="columnleft-2">
                        <div class="supercheckout-column-left columnleftsort" id="column-2-upper" style="width:100%;height:auto;"> 
                        </div>
                        <div class="supercheckout-column-left columnleftsort" id="column-1-inside" style="width:{% set i= settings['general']['column_width'][layout_name]['inside'][1] * 0.999 %}{{ i }}%"> 
                        </div>
                        <div class="supercheckout-column-left columnleftsort" id="column-2-inside"  style="width:{% set i= settings['general']['column_width'][layout_name]['inside'][2] * 0.99 %}{{ i }}%">
                        </div>
                        <div class="supercheckout-column-left columnleftsort" id="column-2-lower"  style="width:100%;height:auto;">
                        </div>
                        
                       
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12" style="width:{% set i= settings['general']['column_width'][layout_name][3]*multiplier %}{{ i }}%">
                    <div class="supercheckout-column-right columnleftsort custom-panel" id="columnleft-3">
                        
                    </div>   
                </div>
            </div>
        </div>
    </fieldset>
</div>
<div class="modal fade" id="agree-model" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
            <span class="close_modal" id="agree-button"><i class="fa fa-times"></i></span> <!--By dharmanshu --><!--By Shivam Bansal -->
                {{ terms_and_condition }}
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="privacy-model" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
            <span class="close_modal" id="privacy-button"><i class="fa fa-times"></i></span> <!--By dharmanshu --><!--By Shivam Bansal -->
                {{ privacy_policy }} 
            </div>
        </div>
    </div>
</div>
{% if (settings['step']['html_value']['value']['footer'] is defined and settings['step']['html_value']['value']['footer'] != "") %} 
    <div id="supercheckout_html_content_footer">        
        {{ ( settings['step']['html_value']['value']['footer']) }} 
    </div>
{% endif %} 
</div>
<script type="text/javascript">
    var autofill_address =  '{{settings['autofill_address']['enable']}}';
    
    $("#confirm_order").click(function() {
        
            if($("#register_manual").is(':checked')){
            $('.account_custom_field').each(function(){
                var getid = $(this).attr('id');
                
                var idrequired = $('#'+getid).attr('data');
                if(idrequired == 'required'){
                    if($('#'+getid).val() == ''){
                        
                        $('#mandatory_field_error_'+getid).remove();
                        var error_msg = "{{ error_required }}";
                        $('#'+getid).after('<p style="color:red !important;" id="mandatory_field_error_'+getid+'">'+ error_msg +'</p>');
                    } else {
                        $('#mandatory_field_error_'+getid).remove();
                    }
                }
            });
        }
        
        if($("[id^='mandatory_field_error']").length > 0){
            goToByScroll('mandatory_field_error');            
            return false;   
        } 
        
        $('.warning, .error').remove();
        var flag = true;
        var error = '';
        var agreeRequire="{{ agree_require }}";
        var agree_option_status = '{% if (text_agree is defined and text_agree != "") %} {{ '1' }} {% else %} {{ '0' }} {% endif %}';
        if((agreeRequire=='loginblock' || agreeRequire=='guestblock')&& agree_option_status == '1') {
            if($('input[name=\'agree\']').is(':checked')){
            }else{
                flag = false;
                error = '{{ agree_error }}';
            }
        }
        var value = $("input:radio[name=account]:checked").val();
        var loggedIn="{{ logged }}";
        if(loggedIn == '' && value=='register_manual'){
            if($('input[name=\'privacy\']').is(':checked')){
            }else{
                flag = false;
                error = '{{ privacy_error }}';
            }
        }
        if(flag){
            $('#confirm_order').attr('disabled', true);
            var btn = $(this);
            btn.prop('disabled', true);
            setTimeout(function(){
                btn.prop('disabled', false);
            }, 5000);
            if(window.confirmclick==true){
                window.callconfirm=true;
            }else{
                validateCheckout();
            }
        }else{
            $('#payment_display_block .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + error + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
            $('#payment_display_block .supercheckout-checkout-content').show();
            $('.warning').fadeIn('slow');
            goToByScroll('payment_display_block');
        }
    });

    /*** ON CHANGING PAYMENT METHOD */
    /*
      Start BY Dharmanshu Gupta for the fixes 9-10-2020
    */
        $(document).on("change", "input[name='payment_method']", function(){
            $('#confirmLoader').css('display','inline-block');
            $.ajax({
                url: 'index.php?route=supercheckout/payment_method/validate',
                type: 'post',
                data: $('#payment-method input[type=\'radio\']:checked, #payment-method input[type=\'checkbox\']:checked, #payment-method textarea'),
                dataType: 'json',
                beforeSend: function() {
                    $('#button-payment-method').attr('disabled', true);
                    $('#button-payment-method').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                },
                complete: function() {
                    $('#button-payment-method').attr('disabled', false);
                    $('.wait').remove();
                },
                success: function(json) {
                    $('#confirmLoader').css('display','none');
                    $('.warning, .error').remove();

                    if (json['redirect']) {
                        location = json['redirect'];
                    } else if (json['error']) {
                        if (json['error']['warning']) {
                            alert(json['error']['warning']);
                            $('#payment-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/delete.png" alt="" class="close" /></div>');
                            $('.warning').fadeIn('slow');
                        }
                    } else {
                        $('#confirmLoader').css('display','inline-block');
                        $.ajax({
                            url: 'index.php?route=supercheckout/confirm',
                            dataType: 'html',
                            success: function(html) {
                                $('#confirmLoader').css('display','none');
                                $('#confirmCheckout').html(html);
                                $('#paymentDisable').html("");
                                $.ajax({
                                    url: 'index.php?route=supercheckout/payment_display',
                                    dataType: 'html',
                                    success: function(html) {
                                        
                                        $('#display_payment').html(html);
                                        
                                        //validatePaymentMethodRefresh();
                                    },
                                    error: function(xhr, ajaxOptions, thrownError) {
                                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                                    }
                                });
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                            }
                        });
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });  
        });
    /*
      End BY Dharmanshu Gupta for the fixes 9-10-2020
    */
    // ON CHANGING SHIPPING  METHOD 

    $("body").on('click', "input[name='shipping_method']", function() {
//        alert('asdad');
        $('#confirmLoader').css('display','inline-block');
        $.ajax({
            url: 'index.php?route=supercheckout/shipping_method/validate',
            type: 'post',
            data: $('#shipping-method input[type=\'radio\']:checked'),
            dataType: 'json',
            beforeSend: function() {
                $('#button-shipping-method').attr('disabled', true);
                $('#button-shipping-method').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
            },
            complete: function() {
                $('#button-shipping-method').attr('disabled', false);
                $('.wait').remove();
            },
            success: function(json) {
                $('#confirmLoader').css('display','none');
                $('.warning, .error').remove();

                if (json['redirect']) {
                    //location = json['redirect'];
                } else if (json['error']) {
                    if (json['error']['warning']) {
                        $('#shipping-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                        $('.warning').fadeIn('slow');
                    }
                } else {
                    $('#paymentMethodLoader').css('display','inline-block');
                    $.ajax({
                        url: 'index.php?route=supercheckout/payment_method',
                        dataType: 'html',
                        success: function(html) {
//                            console.log(html);
                            $('#payment-method').html(html);
                            $('#paymentMethodLoader').css('display','none');
            
                            $('#confirmLoader').css('display','inline-block');
                            $.ajax({
                                url: 'index.php?route=supercheckout/confirm',
                                dataType: 'html',
                                success: function(html) {
                                    //updatecartinheader();           
                                    $('#confirmLoader').css('display','none');
                                    $('#confirmCheckout').html(html);
                                    $('#paymentDisable').html("");
                                    $.ajax({
                                        url: 'index.php?route=supercheckout/payment_display',
                                        dataType: 'html',
                                        success: function(html) {
                                            $('#display_payment').html(html);
                                            //validatePaymentMethodRefresh();
                                        },
                                        error: function(xhr, ajaxOptions, thrownError) {
                                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                                        }
                                    });
                                },
                                error: function(xhr, ajaxOptions, thrownError) {
                                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                                }
                            });
                        }
                    });
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
    
  
    // ON CONFIRM CLICK VALIDATING THE WHOLE PAGE AT ONCE AND DISPLAYS ERROR ACCORDINGLY
    function goToByScroll(id){
        // Remove "link" from the ID
        id = id.replace("link", "");
        // Scroll
        $('html,body').animate({scrollTop: $("#"+id).offset().top}, 'slow');
    }

function validatePaymentAddress(){

    var paymentAddressEnable="1";

    if(paymentAddressEnable==1){
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/loginPaymentAddressValidate',
            type: 'post',
            data: $('#checkoutBillingAddress input[type=\'text\'], #checkoutBillingAddress input[type=\'password\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #checkoutBillingAddress input[type=\'radio\']:checked, #checkoutBillingAddress input[type=\'hidden\'], #checkoutBillingAddress select'),
            dataType: 'json',
            beforeSend: function() {
                $('#button-payment-address').attr('disabled', true);
                $('#button-payment-address').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
            },
            complete: function() {
                $('#button-payment-address').attr('disabled', false);
                $('.wait').remove();
            },
            success: function(json) {
                $('.warning, .errorsmall').remove();

                if (json['redirect']) {
                    location = json['redirect'];
                } else if (json['error']) {
                    enableForm();
                    goToByScroll('checkoutBillingAddress');
                    if (json['error']['warning']) {
                        $('#checkoutBillingAddress .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                        $('#checkoutBillingAddress .supercheckout-checkout-content').show();
                        $('.warning').fadeIn('slow');
                    }

                    if (json['error']['firstname']) {
                        $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                    }
                    
                    if (json['error']['custom_field']) {
                        for( x in json['error']['custom_field'] ){
                            $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                        }
                    }
                    
                    if (json['error']['lastname']) {
                        $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                    }

                    if (json['error']['telephone']) {
                        $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                    }
                    if (json['error']['company']) {
                        $('#payment-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                    }
                    if (json['error']['address_1']) {
                        $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                    }
                    if (json['error']['address_2']) {
                        $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                    }

                    if (json['error']['city']) {
                        $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                    }

                    if (json['error']['postcode']) {
                        $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                    }

                    if (json['error']['country']) {
                        $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                    }

                    if (json['error']['zone']) {
                        $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                    }
                } else {
                    progressbar(35);
                    validateLoginShippingAddress();
                }
            }
        });
    }
    else{
        progressbar(35);
        validateLoginShippingAddress();
    }
}

function progressbar(value){
    $('#progressbar').html('<div class="ui-progressbar-value ui-corner-left ui-widget-header" style="width: '+ value +'%;"></div>')
}
function validateLoginShippingAddress(){
    var paymentAddressEnable="1";
    var shippingMethodEnable="{{ settings['step']['shipping_method']['display_options'] }}";
    var paymentMethodEnable="{{ settings['step']['payment_method']['display_options'] }}";
    if(paymentAddressEnable==1){
        if(!$('#shipping_use').is(":checked")){
            
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/loginShippingAddressValidate',
                type: 'post',
                data: $('#checkoutShippingAddress input[type=\'text\'], #checkoutShippingAddress input[type=\'password\'], #checkoutShippingAddress input[type=\'checkbox\']:checked, #checkoutShippingAddress input[type=\'radio\']:checked, #checkoutShippingAddress select'),
                dataType: 'json',
                beforeSend: function() {
                    $('#button-shipping-address').attr('disabled', true);
                    $('#button-shipping-address').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                },
                complete: function() {
                    $('#button-shipping-address').attr('disabled', false);


                    $('.wait').remove();
                },
                success: function(json) {
                    $('.warning, .error').remove();

                    if (json['redirect']) {
                        location = json['redirect'];
                    } else if (json['error']) {
                        enableForm();
                        if (json['error']['warning']) {
                            $('#checkoutShippingAddress .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                            $('#checkoutShippingAddress .supercheckout-checkout-content').show();
                            $('.warning').fadeIn('slow');
                        }
                        goToByScroll('checkoutShippingAddress');
                        if (json['error']['firstname']) {
                            $('#shipping-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#shipping-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#shipping-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }
                        if (json['error']['company']) {
                            $('#shipping-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                        }
                        if (json['error']['email']) {
                            $('#shipping-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#shipping-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }

                        if (json['error']['address_1']) {
                            $('#shipping-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#shipping-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#shipping-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#shipping-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#shipping-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#shipping-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                    } else {
                        progressbar(50);
                        if(shippingMethodEnable==1){
                            validateShippingMethod();
                        }else{
                            if(paymentMethodEnable==1){
                                validatePaymentMethod();
                            }else{
                                var agreeRequire="{{ agree_require }}";
                                if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                                    validateAgree();
                                }
                                else{
                                    goToConfirm();
                                }
                            }
                        }
                    }
                }
            });
        }else{
            if(shippingMethodEnable==1){
                validateShippingMethod();
            }else{
                if(paymentMethodEnable==1){
                    validatePaymentMethod();
                }else{
                    var agreeRequire="{{ agree_require }}";
                    if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                        validateAgree();
                    }
                    else{
                        goToConfirm();
                    }
                }
            }
        }
    }
    else{
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/loginShippingAddressValidate',
            type: 'post',
            data: $('#checkoutShippingAddress input[type=\'text\'], #checkoutShippingAddress input[type=\'password\'], #checkoutShippingAddress input[type=\'radio\']:checked, #checkoutShippingAddress select'),
            dataType: 'json',
            beforeSend: function() {
                $('#button-shipping-address').attr('disabled', true);
                $('#button-shipping-address').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
            },
            complete: function() {
                $('#button-shipping-address').attr('disabled', false);
                $('.wait').remove();
            },
            success: function(json) {
                $('.warning, .error').remove();

                if (json['redirect']) {
                    location = json['redirect'];
                } else if (json['error']) {
                    enableForm();
                    if (json['error']['warning']) {
                        $('#checkoutShippingAddress .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                        $('#checkoutShippingAddress .supercheckout-checkout-content').show();
                        $('.warning').fadeIn('slow');
                    }

                    if (json['error']['firstname']) {
                        $('#shipping-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                    }
                    
                    
                    if (json['error']['custom_field']) {
                        for( x in json['error']['custom_field'] ){
                            $('#shipping-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                        }
                    }
                    
                    if (json['error']['lastname']) {
                        $('#shipping-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                    }
                    if (json['error']['company']) {
                        $('#shipping-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                    }
                    if (json['error']['email']) {
                        $('#shipping-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                    }

                    if (json['error']['telephone']) {
                        $('#shipping-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                    }

                    if (json['error']['address_1']) {
                        $('#shipping-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                    }
                    if (json['error']['address_2']) {
                        $('#shipping-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                    }
                    if (json['error']['city']) {
                        $('#shipping-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                    }

                    if (json['error']['postcode']) {
                        $('#shipping-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                    }

                    if (json['error']['country']) {
                        $('#shipping-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                    }

                    if (json['error']['zone']) {
                        $('#shipping-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                    }
                } else {
                    progressbar(50);
                    if(shippingMethodEnable==1){
                        validateShippingMethod();
                    }else{
                        if(paymentMethodEnable==1){
                            validatePaymentMethod();
                        }else{
                            var agreeRequire="{{ agree_require }}";
                            if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                                validateAgree();
                            }
                            else{
                                goToConfirm();
                            }
                        }
                    }
                }
            }
        });
    }
}
function validateShippingMethod(){
    var paymentMethodEnable="{{ settings['step']['payment_method']['display_options'] }}";
    $.ajax({
        url: 'index.php?route=supercheckout/shipping_method/validate',
        type: 'post',
        data: $('#shipping-method input[type=\'radio\']:checked'),
        dataType: 'json',
        beforeSend: function() {
            $('#button-shipping-method').attr('disabled', true);
            $('#button-shipping-method').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
        },
        complete: function() {
            $('#button-shipping-method').attr('disabled', false);
            $('.wait').remove();
        },
        success: function(json) {
            $('.warning, .error').remove();

            if (json['redirect']) {
            //				location = json['redirect'];
            } else if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#shipping-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#shipping-method .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                }
            } else {
                progressbar(65);
                if(paymentMethodEnable==1){
                    validatePaymentMethod();
                }else{
                    var agreeRequire="{{ agree_require }}";
                    if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                        validateAgree();
                    }
                    else{
                        goToConfirm();
                    }
                }
            }
        }
    });
}
function validatePaymentMethod(){
    $.ajax({
        url: 'index.php?route=supercheckout/payment_method/validate',
        type: 'post',
        data: $('#payment-method input[type=\'radio\']:checked, #payment-method input[type=\'checkbox\']:checked, #payment-method textarea,#payment_display_block input[type=\'checkbox\']'),
        dataType: 'json',
        beforeSend: function() {
            $('#button-payment-method').attr('disabled', true);
            $('#button-payment-method').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
        },
        complete: function() {
            $('#button-payment-method').attr('disabled', false);
            $('.wait').remove();
        },
        success: function(json) {
            $('.warning, .error').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#payment-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#payment-method .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                }else if(json['error']['warnings']){
                    $('#payment_display_block .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warnings'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#payment_display_block .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('payment_display_block');
                }
            } else {
                progressbar(80);
                var agreeRequire="{{ agree_require }}";
                var comment="{{ comment_check }}";
                if(comment=='loginblock' || comment=='guestblock'){
                    setComment();
                }
                if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                    validateAgree();

                }
                else{
                    goToConfirm();
                }
            }
        }
    });
}
function setComment(){

    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/setCommentSession',
        type: 'post',
        data: $('#supercheckout-comment_order'),
        dataType: 'json',
        success: function(json) {
            
        }
    });
}
function validateAgree(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/validateAgree',
        type: 'post',
        data: $('#payment_display_block input[type=\'checkbox\']:checked'),
        dataType: 'json',
        success: function(json) {
            $('.warning, .error').remove();

            if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#payment_display_block .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#payment_display_block .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('payment_display_block');
                }
            } else {
                goToConfirm();
            }
        }
    });

}
function createGuestAccount(){
    
     if ( $('#newsletter').is(':checked'))
    {
    $("#newsletter").attr("value","1"); //to set value 1 if user check newsletter checkbox
    
    }
   else{
       $("#newsletter").attr("value","0");
   
        }
        
        var selectedValue = "";
        $("#checkoutLogin").find("select").each(function(){
            alert($(this).val());
        })
               
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/createGuestAccount',
        type:'post',
        data: $('#checkoutLogin input[type=\'text\'], #checkoutLogin select, #customer_group_div input[type=\'radio\']:checked, #supercheckout-login-register-manual input[type=\'hidden\'],#newsletter'),
        success: function(html) {            
            progressbar(60);
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
}
function goToConfirm(){
   //Start BY dharmanshu for preveting double click on the button
    $("#placeorderButton *").attr("disabled", "disabled").off('click');
//End BY dharmanshu for preveting double click on the button
        setComment();
        setTimeout(function(){

       
<!--*************** MAILCHIMP ******************-->
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/mailchimp',
            dataType: 'json',
            type:'post',
            data: {
                'newsletter' : '1',
            },
            success: function(json) {
                
            }
        });
<!--*************** KLAVIYO ******************-->   
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/klaviyo',
            dataType: 'json',
            type:'post',
            data: {
                'newsletter' : '1',
            },
            success: function(json) {
            
            }
        });
        
<!--*************** SENDINBLUE ******************-->   
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/sendinBlue',
            dataType: 'json',
            type:'post',
            data: {
                'newsletter' : '1',
            },
            success: function(json) {
            
            }
        });
        
        $.ajax({
        url: 'index.php?route=supercheckout/confirm',
        dataType: 'html',
        success: function(html) {
            
//            addToMailchimp();
            progressbar(100);
            var href = $("{{ hidden_classes }} ").attr('href');
            if(href != '' && href != undefined && href != 'javascript://' && href != 'javascript:void(0)') {
                document.location.href = href;
                console.log('clicked');	
            }else{
		enableForm();
                $("{{ hidden_classes_trigger }}").trigger("click", function(){	
                console.log('clicked');	
            })
            }
//            $("#button-confirm , input[type=submit] , .display_payment .button, #display_payment .button").trigger("click");
        //            $("#button-confirm , input[type=submit]").unbind("click");
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
     },5000)
}
function validateEmail(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/validateEmail',
        type: 'post',
        data: $('#checkoutLogin input[type=\'text\']'),
        dataType: 'json',
        success: function(json) {
            $('.warning, .error').remove();
            if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin');
                }
            }
            else {
                progressbar(20);
                validateGuestPaymentAddress();
            }

        }
    });
}
function validateEmailAndPassword(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/validateEmailAndPassword',
        type: 'post',
        data: $('#checkoutLogin input[type=\'text\'],#checkoutLogin input[type=\'password\']'),
        dataType: 'json',
        success: function(json) {
//            console.log(json);
            $('.warning, .error').remove();
            if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin');
                }
                if(json['error']['mismatch']){ 
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['mismatch'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin');
                }
                if(json['error']['password']){ 
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['password'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin');
                }
            }else {
                progressbar(20);
                validateGuestPaymentAddress();
            }

        }
    });
}
function matchPassword(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/validateEmailAndPassword',
        type: 'post',
        data: $('#checkoutLogin input[type=\'text\'],#checkoutLogin input[type=\'password\']'),
        dataType: 'json',
        success: function(json) {
            $('.warning, .error').remove();
            if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin ');
                }
                if(json['error']['mismatch']){ 
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['mismatch'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin ');
                }
                if(json['error']['password']){ 
                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['password'] + '</div>');
                    $('#checkoutLogin .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('checkoutLogin ');
                }
            }
        }
    });
}
function validateGuestPaymentAddress(){
    var paymentGuestAddressEnable="1";
    var useforShippingEnable="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}";
    if(paymentGuestAddressEnable==1){
        if(useforShippingEnable==1){
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/guestPaymentAddressValidate',
                type: 'post',
                data: $('#payment-new  input[type=\'text\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #payment-new select, #checkoutLogin input[name=\'email\'] '),
                dataType: 'json',
                beforeSend: function() {
                    $('#button-guest').attr('disabled', true);
                    $('#button-guest').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                },
                complete: function() {
                    $('#button-guest').attr('disabled', false);
                    $('.wait').remove();
                },
                success: function(json) {
                    $('.warning, .errorsmall').remove();

                    if (json['redirect']) {
                        location = json['redirect'];
                    }
                    else if (json['error']) {
                        enableForm();
                        if (json['error']['warning']) {
                            $('#payment-new .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');

                            $('.warning').fadeIn('slow');
                        }

                        if (json['error']['firstname']) {
                            $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }

                        if (json['error']['email']) {
                            $('#payment-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }
                        if (json['error']['company']) {
                            $('#payment-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                        }
                        if (json['error']['address_1']) {
                            $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                        goToByScroll('checkoutBillingAddress');
                    }
                    else {
                        progressbar(35);
                        checkGuestShippingAddress();
                    }
                }
            });
        }
        else{
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/guestPaymentAddressValidate',
                type: 'post',
                data: $('#payment-new  input[type=\'text\'],  #payment-new select , #checkoutLogin input[name=\'email\']'),
                dataType: 'json',
                beforeSend: function() {
                    $('#button-guest').attr('disabled', true);
                    $('#button-guest').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                },
                complete: function() {
                    $('#button-guest').attr('disabled', false);
                    $('.wait').remove();
                },
                success: function(json) {
                    $('.warning, .errorsmall').remove();

                    if (json['redirect']) {
                        location = json['redirect'];
                    }
                    else if (json['error']) {
                        enableForm();
                        if (json['error']['warning']) {
                            $('#payment-new .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');

                            $('.warning').fadeIn('slow');
                        }

                        if (json['error']['firstname']) {
                            $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }

                        if (json['error']['email']) {
                            $('#payment-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }
                        if (json['error']['address_1']) {
                            $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                        goToByScroll('checkoutBillingAddress');
                    }
                    else {
                        progressbar(35);
                        checkGuestShippingAddress();
                    }
                }
            });
        }
    }else{

        validateGuestShippingAddress();
    }
}
function validateGuestShippingAddress(){
    var paymentMethodEnable="{{ settings['step']['payment_method']['display_options'] }}";
    var shippingMethodEnable="{{ settings['step']['shipping_method']['display_options'] }}";
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/guestShippingAddressValidate',
        type: 'post',
        data: $('#shipping-new input[type=\'text\'], #shipping-new select'),
        dataType: 'json',
        beforeSend: function() {
            $('#button-guest-shipping').attr('disabled', true);
            $('#button-guest-shipping').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
        },
        complete: function() {
            $('#button-guest-shipping').attr('disabled', false);
            $('.wait').remove();
        },
        success: function(json) {
            $('.warning, .errorsmall').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                enableForm();
                if (json['error']['warning']) {
                    $('#shipping-new .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');

                    $('.warning').fadeIn('slow');
                }

                if (json['error']['firstname']) {
                    $('#shipping-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                }

                if (json['error']['custom_field']) {
                    for( x in json['error']['custom_field'] ){
                        $('#shipping-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                    }
                }

                if (json['error']['lastname']) {
                    $('#shipping-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                }
                if (json['error']['company']) {
                    $('#shipping-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                }
                if (json['error']['address_1']) {
                    $('#shipping-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                }
                if (json['error']['address_2']) {
                    $('#shipping-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                }
                if (json['error']['city']) {
                    $('#shipping-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                }

                if (json['error']['postcode']) {
                    $('#shipping-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                }

                if (json['error']['country']) {
                    $('#shipping-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                }

                if (json['error']['zone']) {
                    $('#shipping-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                }
                goToByScroll('checkoutShippingAddress');
            } else {
                progressbar(50);
                var checkGuestRegisterEnable="{{ settings['general']['guestenable'] }}";
                var checkRegisterManualEnable="{{ settings['general']['guest_manual'] }}";
                var use_password_string = "";
                var loginRadioCheck=$("input:radio[name=account]:checked").val();
                if(checkRegisterManualEnable==1 && loginRadioCheck=="register_manual"){
                    use_password_string = '&use_password=1';
                }
    /////////////////////////////////////////////////////////////////////////////////////////
                if(checkGuestRegisterEnable==0 && loginRadioCheck=="guest"){
                    use_password_string = '&use_password=0';
                } //first out of two loops to fix always registering guest with password
    /////////////////////////////////////////////////////////////////////////////////////////
                if(checkGuestRegisterEnable==1 || checkRegisterManualEnable==1){
                  if ( $('#newsletter').is(':checked'))
                  $("#newsletter").attr("value","1");
                 else{
                  $("#newsletter").attr("value","0");
                   }
    
                         $.ajax({
                        url: 'index.php?route=supercheckout/supercheckout/createGuestAccount'+use_password_string,
                        type:'post',
                        dataType:'json',
                        data: $('#checkoutLogin input[type=\'text\'],#checkoutLogin select , #customer_group_div input[type=\'radio\']:checked, #checkoutLogin input[name=\'password_register\'], #newsletter , #supercheckout-login-register-manual input[type=\'hidden\']'),
                        success: function(json) {   
                            if (json['error']) {
                                enableForm();
                                if (json['error']['warning']) {
                                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                                    $('#checkoutLogin .supercheckout-checkout-content').show();
                                    $('.warning').fadeIn('slow');
                                    goToByScroll('checkoutLogin');
                                }
                            }else{
                                progressbar(60);
                                if(shippingMethodEnable==1){
                                    validateShippingMethod();
                                }else{
                                    if(paymentMethodEnable==1){
                                        validatePaymentMethod();
                                    }else{
                                       var agreeRequire="{{ agree_require }}";
                                        if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                                            validateAgree();
                                        }
                                        else{
                                            goToConfirm();
                                        }
                                    }
                                }
                            }
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }else{
                    if(shippingMethodEnable==1){
                        validateShippingMethod();
                    }else{
                        if(paymentMethodEnable==1){
                            validatePaymentMethod();
                        }else{
                            var agreeRequire="{{ agree_require }}";
                            if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                                validateAgree();
                            }
                            else{
                                goToConfirm();
                            }
                        }
                    }
                }
                
            }
        }
    });
}
function checkGuestShippingAddress(){
    var ShippingUseEnable="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}"
    var paymentGuestAddressEnable="1";
    var paymentMethodEnable="{{ settings['step']['payment_method']['display_options'] }}";
    var shippingMethodEnable="{{ settings['step']['shipping_method']['display_options'] }}";
    if(ShippingUseEnable==1)
    {
        if($('#shipping_use').is(":checked")){
            
            var checkGuestRegisterEnable="{{ settings['general']['guestenable'] }}";
            var checkRegisterManualEnable="{{ settings['general']['guest_manual'] }}";
                var use_password_string = "";
                var loginRadioCheck=$("input:radio[name=account]:checked").val();
                if(checkRegisterManualEnable==1 && loginRadioCheck=="register_manual"){
                    use_password_string = '&use_password=1';
                }
   /////////////////////////////////////////////////////////////////////////////////////////
                if(checkGuestRegisterEnable==0 && loginRadioCheck=="guest"){
                    use_password_string = '&use_password=0';
                } // second out of two loops to fix always registering guest with password
     /////////////////////////////////////////////////////////////////////////////////////////
                if(checkGuestRegisterEnable==1 || checkRegisterManualEnable==1){
                    if ( $('#newsletter').is(':checked'))
                    $("#newsletter").attr("value","1");
                   else{
                       $("#newsletter").attr("value","0");
                   } $.ajax({
                        url: 'index.php?route=supercheckout/supercheckout/createGuestAccount'+use_password_string,
                        type:'post',
                        dataType:'json',
                        data: $('#checkoutLogin input[type=\'text\'], #checkoutLogin select, #customer_group_div input[type=\'radio\']:checked, #checkoutLogin input[type=\'hidden\'],#checkoutLogin input[name=\'password_register\'], #newsletter'),
                        success: function(json) {   
                            if (json['error']) {
                                enableForm();
                                if (json['error']['warning']) {
                                    $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                                    $('#checkoutLogin .supercheckout-checkout-content').show();
                                    $('.warning').fadeIn('slow');
                                    goToByScroll('checkoutLogin');
                                }
                            }else{
                                progressbar(60);
                                if(shippingMethodEnable==1){
                                    validateShippingMethod();
                                }else{
                                    if(paymentMethodEnable==1){
                                        validatePaymentMethod();
                                    }else{
                                        var agreeRequire="{{ agree_require }}";
                                        if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                                            validateAgree();
                                        }
                                        else{
                                            goToConfirm();
                                        }
                                    }
                                }
                            }
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
            }else{
                if(shippingMethodEnable==1){
                    validateShippingMethod();
                }else{
                    if(paymentMethodEnable==1){
                        validatePaymentMethod();
                    }else{
                        var agreeRequire="{{ agree_require }}";
                        if(agreeRequire=='loginblock' || agreeRequire=='guestblock'){
                            validateAgree();
                        }
                        else{
                            goToConfirm();
                        }
                    }
                }
            }
            
        }
        else{
            validateGuestShippingAddress();
        }
    }else{
        validateGuestShippingAddress()
    }

}

function validateCheckout(){
    disableForm();
    var loginRadio=$("input:radio[name=account]:checked").val();
    var guestEnable="{{ settings['step']['login']['option']['guest']['display'] }}";
    var loggedIn="{{ logged }}";//271
    if(guestEnable==0)
    {
	
	if(loginRadio=='register_manual'){
	    validateEmailAndPassword();
	}
        else if(loginRadio=='register') { 
	    if(loggedIn==''){
                $('#checkoutLogin .supercheckout-checkout-content').html('<div class="warning" style="display: none;">' + '{{ please_login_error }}' + '</div>');
                $('#checkoutLogin .supercheckout-checkout-content').show();
                $('.warning').fadeIn('slow');
                enableForm();
                goToByScroll('checkoutLogin');
            }
        } else {
            validatePaymentAddress();
        }
    } else {
        var loginRadio=$("input:radio[name=account]:checked").val();
        if(loginRadio=="register") {
            if(loggedIn=='') {
                $('#checkoutLogin .supercheckout-checkout-content').html('<div class="warning" style="display: none;">' + '{{ please_login_error }}' + '</div>');
                $('#checkoutLogin .supercheckout-checkout-content').show();
                $('.warning').fadeIn('slow');
                goToByScroll('checkoutLogin');
                enableForm();
            }
        }
        else if(loginRadio == "guest") {
            validateEmail();
        }else if(loginRadio == "register_manual"){
            validateEmailAndPassword();
        }
        if(loggedIn) {
            validatePaymentAddress();
        }
//        var loginRadio=$("input:radio[name=account]:checked").val();
//        if(loginRadio=="register") {
//            validateEmailAndPassword();
//        }
//        else if(loginRadio == "guest") {
//            validateEmail();
//        }
//        if(loggedIn) {
//            validatePaymentAddress();
//        }
    }
//    if(loginEnable==0 && guestEnable==0)
//    {
//
//        if(loggedIn==''){
//            $('#checkoutLogin .supercheckout-checkout-content').html('<div class="warning" style="display: none;">' + '{{ please_login_error }}' + '</div>');
//            $('#checkoutLogin .supercheckout-checkout-content').show();
//            $('.warning').fadeIn('slow');
//            $('html, body').animate({
//                scrollTop: 0
//            }, 'slow');
//        }else{
//            validatePaymentAddress();
//        }
//    }
}
//FOR REFRESSHING STEPS TO GET ORDER DETAILS
function validatePaymentAddressRefresh(){

    var paymentAddressEnable="1";
    if(paymentAddressEnable==1){
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/setValueForLoginPayment',
            type: 'post',
            dataType:'json',
            data: $('#checkoutBillingAddress input[type=\'text\'], #checkoutBillingAddress input[type=\'password\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #checkoutBillingAddress input[type=\'radio\']:checked, #checkoutBillingAddress input[type=\'hidden\'], #checkoutBillingAddress select, #checkoutBillingAddress input[type=\'checkbox\']:checked'),
            success: function(json) {
                    validateLoginShippingAddressRefresh();
            }
        });
    }
    else{
        validateLoginShippingAddressRefresh();
    }
}
function validateLoginShippingAddressRefresh() {
    var paymentAddressEnable="1";
    if(paymentAddressEnable==1){
        if(!$('#shipping_use').is(":checked")){
            
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/setValueForLoginShipping',
                type: 'post',
                data: $('#checkoutShippingAddress input[type=\'text\'], #checkoutShippingAddress input[type=\'password\'], #checkoutShippingAddress input[type=\'checkbox\']:checked, #checkoutShippingAddress input[type=\'radio\']:checked, #checkoutShippingAddress select'),
                success: function(json) {
//                    console.log(json);
                    $('.warning, .error').remove();
                    

                    {
                        refreshAll();
                    }
                }
            });
        } else {
            refreshAll();
        }
    }
    else{
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/setValueForLoginShipping',
            type: 'post',
            data: $('#checkoutShippingAddress input[type=\'text\'], #checkoutShippingAddress input[type=\'password\'], #checkoutShippingAddress input[type=\'radio\']:checked, #checkoutShippingAddress select'),
            success: function(json) {
                refreshAll();
            }
        });
    }
}
function validateShippingMethodRefresh(){
    $.ajax({
        url: 'index.php?route=supercheckout/shipping_method/validate',
        type: 'post',
        data: $('#shipping-method input[type=\'radio\']:checked'),
        dataType: 'json',
        success: function(json) {
            $('.warning, .error').remove();

            if (json['redirect']) {
            } else if (json['error']) {
                if (json['error']['warning']) {
                    $('#shipping-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#shipping-method .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                }
            } else {
                validatePaymentMethodRefresh();
            }
        }
    });
}

function validatePaymentMethodRefresh(){
    $.ajax({
        url: 'index.php?route=supercheckout/payment_method/validate',
        type: 'post',
        data: $('#payment-method input[type=\'radio\']:checked, #payment-method input[type=\'checkbox\']:checked, #payment-method textarea,#payment_display_block input[type=\'checkbox\']'),
        dataType: 'json',
        success: function(json) {
            $('.warning, .error').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                if (json['error']['warning']) {
                    $('#payment-method .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#payment-method .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                } else if(json['error']['warnings']) {
                    $('#payment_display_block .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warnings'] + '<img src="catalog/view/theme/{{ default_theme }}/image/close.png" alt="" class="close" /></div>');
                    $('#payment_display_block .supercheckout-checkout-content').show();
                    $('.warning').fadeIn('slow');
                    goToByScroll('payment_display_block');
                }
            } else {
                goToConfirmRefresh();
            }
        }
    });
}

function goToConfirmRefresh(){
    $.ajax({
        url: 'index.php?route=supercheckout/confirm',
        dataType: 'html',
        success: function(html) {
//            console.log(html);
            $('#confirmLoader').css('display','none');
            $('#confirmCheckout').html(html);
            $('#paymentDisable').html("");
            $.ajax({
                url: 'index.php?route=supercheckout/payment_display',
                dataType: 'html',
                success: function(html) {
                    $('#display_payment').html(html);
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
            if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
            }
            window.callconfirm=false;
            window.confirmclick=false;
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });

}
function validateGuestPaymentAddressRefresh(){
    var paymentGuestAddressEnable="1";
    var useforShippingEnable="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}";
    //alert(useforShippingEnable);
    if(paymentGuestAddressEnable==1){
        if(useforShippingEnable==1){
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/setValueForGuestPayment',
                type: 'post',
                data: $('#payment-new  input[type=\'text\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #payment-new select, #checkoutLogin input[name=\'email\'] '),
                success: function(json) {
                    $('.warning, .errorsmall').remove();

                    {
                        checkGuestShippingAddressRefresh();
                        
                    }
                }
            });
        }
        else{
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/setValueForGuestPayment',
                type: 'post',
                data: $('#payment-new  input[type=\'text\'],  #payment-new select'),
                success: function(json) {
                {
                    checkGuestShippingAddressRefresh();
                }
                }
            });
        }
    }else{

        validateGuestShippingAddressRefresh();
    }
}
function validateGuestShippingAddressRefresh(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/setValueForGuestShipping',
        type: 'post',
        data: $('#shipping-new input[type=\'text\'], #shipping-new select'),
        success: function() {
            $('.warning, .errorsmall').remove();
            refreshAll();

        }
    });
}
function checkGuestShippingAddressRefresh(){
    var ShippingUseEnable="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}"
    var paymentGuestAddressEnable="1";
//alert(ShippingUseEnable);
    if(ShippingUseEnable==1)
    {
        if($('#shipping_use').is(":checked")){
        
            
            refreshAll();
        }
        else{
	    
            validateGuestShippingAddressRefresh();
        }
    }else{
        validateGuestShippingAddressRefresh()
    }

}


function validateCheckoutRefresh(){
    var guestEnable="{{ settings['step']['login']['option']['guest']['display'] }}";
    var loggedIn="{{ logged }}";//271
    if(guestEnable==0)
    {
        validatePaymentAddressRefresh();
    }
//    if(loginEnable==0 && guestEnable==1)
//    {
//        validateGuestPaymentAddressRefresh();
//    }
    else
    {
        if(loggedIn!=""){
            validatePaymentAddressRefresh();
        }else{
            validateGuestPaymentAddressRefresh();
        }
    }
//    if(loginEnable==0 && guestEnable==0)
//    {
//            validatePaymentAddressRefresh();
//    }
}

</script>
<script type="text/javascript">
    $('#checkoutShippingAddress input[name=\'shipping_address\']').on('change', function() {
        if (this.value == 'new') {
            $('#shipping-existing').hide();
            $('#shipping-new').show();
            validateCheckoutRefresh();
        } else {
            $('#shipping-existing').show();
            $('#shipping-new').hide();
            validateCheckoutRefresh();
        }
    });
</script>
<script type="text/javascript">
// GENERAL SETTING FOR HIDING DISPLAYING NEW & EXISTING SHIPPING ADDRESS
$('#shipping-existing select[name=\'address_id\']').bind('change', function() {
        validateCheckoutRefresh();
    });
    $('#payment-existing select[name=\'address_id\']').bind('change', function() {
        validateCheckoutRefresh();
    });
    $('#shipping-new select[name=\'country_id\']').bind('change', function() {
        if (this.value == '') return;

        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/country&country_id=' + this.value,
            dataType: 'json',
            beforeSend: function() {
                $('#shipping-new select[name=\'country_id\']').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
            },
            complete: function() {
                $('.wait').remove();
            },
            success: function(json) {
                if (json['postcode_required'] == '1') {                
                    $('#shipping-postcode-required').show();
                } else {                
                    $('#shipping-postcode-required').hide();
                }

                html = '<option value="">{{ text_select }}</option>';

                if (json['zone'] != '') {
                    for (i = 0; i < json['zone'].length; i++) {
                        html += '<option value="' + json['zone'][i]['zone_id'] + '"';

                        if (json['zone'][i]['zone_id'] == '{{ zone_id }}') {
                            html += ' selected="selected"';
                        }

                        html += '>' + json['zone'][i]['name'] + '</option>';
                    }
                } else {
                    html += '<option value="0" selected="selected">{{ text_none }}</option>';
                }
                
                if (autofill_address == 1) {
                    initAutocomplete();
                }
                
                $('#shipping-new select[name=\'zone_id\']').html(html);
                validateCheckoutRefresh();


            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
</script>
<script type="text/javascript">
    
// GENERAL SETTING FOR HIDING DISPLAYING NEW & EXISTING BILLING ADDRESS
$('#checkoutBillingAddress input[name=\'payment_address\']').on('change', function() {
    if (this.value == 'new') {
        $('#payment-existing').hide();
        $('#payment-new').show();
        validateCheckoutRefresh();
    } else {
        $('#payment-existing').show();
        $('#payment-new').hide();
        validateCheckoutRefresh();
    }
});
$('#payment-new select[name=\'zone_id\']').bind('change', function() {
    validateCheckoutRefresh();
});
$('#shipping-new select[name=\'zone_id\']').bind('change', function() {
    validateCheckoutRefresh();
});
$('#payment-new select[name=\'country_id\']').bind('change', function() {
    if (this.value == '') return;
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/country&country_id=' + this.value,
        dataType: 'json',
        beforeSend: function() {
            $('#payment-new select[name=\'country_id\']').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
        },
        complete: function() {
            $('.wait').remove();
        },
        success: function(json) {
            if (json['postcode_required'] == '1') {
                $('#payment-postcode-required').show();
            } else {
                $('#payment-postcode-required').hide();
            }

            html = '<option value="">{{ text_select }}</option>';
            if (json['zone'] != '') {
                for (i = 0; i < json['zone'].length; i++) {
                    html += '<option value="' + json['zone'][i]['zone_id'] + '"';
                    html += '>' + json['zone'][i]['name'] + '</option>';
                }
            } else {
                html += '<option value="0" selected="selected">{{ text_none }}</option>';
            }
            
            if (autofill_address == 1) {
                initAutocomplete();
            }
            
            validateCheckoutRefresh();
            $('#payment-new select[name=\'zone_id\']').html(html);
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});

//ON CHECKING - UNCHECKING USE FOR SHIPPING CHECKBOX
/*
Start by Shivam Bansal for the Closing the Popup
*/
/*
Start by Dharmanshu for the model box fixes
*/
$('#agree-button').click(function(){
    $('#agree-model').modal('toggle');
})
$('#privacy-button').click(function(){
    $('#privacy-model').modal('toggle');
})
/*
End by Dharmanshu for the model box fixes
*/
/*
End by Shivam Bansal for the Closing the Popup
*/
    $(document).ready(function(){
    
     var send_password="{{ settings['general']['guestenable'] }}";
   var value = $("input:radio[name=account]:checked").val();
   
   var logged="{{ logged }}";
   var newsletter_setting="{{ settings['general']['newsletter'] }}"
  
     if(value=='register_manual')
     $('#use_password').val('1');
     else
     $('#use_password').val('0');
         



if(logged!=1&&newsletter_setting==1)
{
if(value=='register_manual'||(value=='guest' && send_password==1))
{
 $('#newsletter_checkbox').css({
            "display": "block"
        });
}
else
    $('#newsletter_checkbox').css({
            "display": "none"
        });
}
else
$('#newsletter_checkbox').css({
            "display": "none"
        });
    
var shipping_display="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}";
var loggedIn="{{ logged }}";//271
if(shipping_display=="0" && loggedIn==""){
    $('#checkoutShippingAddress').slideDown('slow');
}
        $("#shipping_use").change(function(){
            if($(this).is(":checked"))
            {
                $('#checkoutShippingAddress').slideUp('slow');
                validateCheckoutRefresh();
            }
            else{
                $('#checkoutShippingAddress').slideDown('slow');
                validateCheckoutRefresh();
            }
        });
    });

// FOR GENERAL SETTINGS LIKE SLIDE UP AND DOWN, AND LOGIN VALIDATION

var generalDefault="{{ settings['general']['default_option'] }}";
var guestEnable="{{ settings['step']['login']['option']['guest']['display'] }}";
var registerEnable="{{ settings['general']['guest_manual'] }}";
var current = $("input:radio[name=account]:checked").val();
if(generalDefault=='guest'&& guestEnable==1 && current=='guest'){
    $('#supercheckout-login').slideUp('slow');
   // $('#supercheckout-login-register-manual').hide();
    $('#customer_group_div').show();
    $('.supercheckout_password_fields').slideUp('slow');
} else if(generalDefault == 'register' && registerEnable == 1) { 
    $('#supercheckout-login-register-manual').slideUp('slow');
    $('#supercheckout-login').slideDown('slow');
    $('#supercheckout-privacy-policy').hide();
    $('#customer_group_div').hide();
} else if(generalDefault=='guest'&&guestEnable==0){ // added if condition here to prevent login dropdown in case of register is selected as default
    $('#supercheckout-login').slideDown('slow');
    $('#supercheckout-login-register-manual').show();
    $('#customer_group_div').show();
    $('.supercheckout_password_fields').slideUp('slow');
} else if (current=='register'||(generalDefault=='register_manual'&&registerEnable==0)){
    $('#supercheckout-login').slideDown('slow');
    $('#customer_group_div').show();
    $('.supercheckout_password_fields').slideDown('slow');
    $('#supercheckout-login-register-manual').hide();
} else if(guestEnable!=1 && registerEnable!=1) { // to slidedown login when both guest checkout and register manual is disable
    $('#customer_group_div').hide();
    $('#supercheckout-login').slideDown('slow');
}
    
    

/////////////////////////////////////////////////////////////////////////
//// Function to handle register when register is selected by default./////
////////////////////////////////////////////////////////////////////////
var value = $("input:radio[name=account]:checked").val();
if (value=="register_manual")
register_manual();
function register_manual()
{
     if(value=='register')
    {
        $('#supercheckout-login-register-manual').slideUp('slow');
        $('#customer_group_div').show();
        $('#supercheckout-login').slideDown('slow');
        $('#supercheckout-privacy-policy').hide();
    }
    else if(value=='guest'){
        $('#supercheckout-login').slideUp('slow');
        $('#supercheckout-login-register-manual').slideUp('slow');
        $('#supercheckout-privacy-policy').hide();
        $('#customer_group_div').show();
        $('#supercheckout-login-register-manual').show();
        $('.supercheckout_password_fields').slideUp('slow');
    }else if(value=='register_manual'){
        $('#supercheckout-login').slideUp('fast');
        $('#supercheckout-login-register-manual').slideDown('slow');
        $('#supercheckout-privacy-policy').show();
//        $('#customer-groups1').prop('checked',true);
        $('.supercheckout_password_fields').slideDown('slow');
    }
}
//////////////////////////////////////////////////////////////////////
////function to handle register when its rasio button is clicked./////
/////////////////////////////////////////////////////////////////////

$("input:radio[name=account]").click(function() {
    var send_password="{{ settings['general']['guestenable'] }}";
    var value = $("input:radio[name=account]:checked").val();
   
    var logged="{{ logged }}";
    var newsletter_setting="{{ settings['general']['newsletter'] }}"
    
    if(value=='register_manual')
        $('#use_password').val('1');
    else
        $("#use_password").val('0');

    if(logged!=1&&newsletter_setting==1)
    {

        if(value=='register_manual'||(value=='guest'&& send_password==1))
        {
         $('#newsletter_checkbox').css({
                    "display": "block"
                });
        }
        else
            $('#newsletter_checkbox').css({
                    "display": "none"
                });
    }
    if(value=='register'){
        $('#supercheckout-login-register-manual').slideUp('slow');
        $('#supercheckout-login').slideDown('slow');
        $('#supercheckout-privacy-policy').hide();
        $('#customer_group_div').hide();
    }else if(value=='guest'){
        $('#supercheckout-login').slideUp('slow');
        $('#supercheckout-privacy-policy').hide();
        $('#customer_group_div').show();
        $('#supercheckout-login-register-manual').show();
        $('.supercheckout_password_fields').slideUp('slow');
        
    }else if(value=='register_manual'){
        $('#supercheckout-login').slideUp('fast');
        $('#supercheckout-login-register-manual').slideDown('slow');
        $('#supercheckout-privacy-policy').show();
        $('#customer_group_div').show();
        $('.supercheckout_password_fields').slideDown('slow');
    }
});

//login
$('#button-login').on('click', function() {
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/loginValidate',
        type: 'post',
        data: $('#checkoutLogin :input'),
        dataType: 'json',
        beforeSend: function() {
            $('#button-login').attr('disabled', true);
            $('#button-login').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
        },
        complete: function() {
            $('#button-login').attr('disabled', false);
            $('.wait').remove();
        },
        success: function(json) {
            $('.warning, .error').remove();

            if (json['redirect']) {
                location = json['redirect'];
            } else if (json['error']) {
                $('#checkoutLogin .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + json['error']['warning'] + '</div>');
                $('#checkoutLogin .supercheckout-checkout-content').show();
                $('.warning').fadeIn('slow');
            }
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
});
// FOR ADDING COUPON AND VOUCHERS AND ALSO REDEEMING THEM
//adding 
$('#confirm_password').blur(function () {        
        matchPassword();
});


//adding voucher
function callVoucher(){
    var code=$('#voucher_code').val();
    
    if(code==""){
        if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.voucherBlur=true;
        
        $("#voucher_code").css({
            "background-color": "#FFD1D1"
        });
    }else{
        $("#voucher_code").css({
            "background-color": "white"
        });
        $('#confirm').html('<div id="loading" style="text-align:center;"><img src="image/data/checkoutPage/loading_large.gif" width="100" height="100"></div>');
        $('#confirmLoader').css('display','inline-block');
        $.ajax({
            type: "POST",
            url: "index.php?route=supercheckout/supercheckout/validateVoucher",
            data: 'voucher='+code,
            success: function(json) {
                var obj = jQuery.parseJSON( json );

                if (obj.warning) {
                    $("#voucher_code").css({
                        "background-color": "#FFD1D1"
                    });
                    $.gritter.add({
                        title: '{{ text_notification }}',
                        text: obj.warning,
                //	image: '',
                        class_name:'gritter-warning',
                        sticky: false,
                        time: '3000'
                    });
//                    $('#confirmCheckout .supercheckout-checkout-content').html("");
//                    $('#confirmCheckout .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + obj.warning + '</div>');
//                    $('.supercheckout-checkout-content').show();
//                    $('.warning').fadeIn('slow');
                    $('#confirmLoader').css('display','none');
                    if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.voucherBlur=true;
                }
                else{
                    $.gritter.add({
                        title: '{{ text_notification }}',
                        text: '{{ text_voucher_success }}',
                //	image: '',
                        class_name:'gritter-success',
                        sticky: false,
                        time: '3000'
                    });
                    validatePaymentMethodRefresh();
                }

            }

        });
    }
}

function callCoupon(){
    var code=$('#coupon_code').val();
     
    if(code==""){
         if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.couponBlur=true; 
            $("#coupon_code").css({
            "background-color": "#FFD1D1"
        });
    }else{
        $("#coupon_code").css({
            "background-color": "white"
        });
        $('#confirm').html('<div id="loading" style="text-align:center;"><img src="image/data/checkoutPage/loading_large.gif" width="100" height="100"></div>');
        $('#confirmLoader').css('display','inline-block');
        $.ajax({
            type: "POST",
            url: "index.php?route=supercheckout/supercheckout/validateCoupon",
            data: 'coupon='+code,

            success: function(json) {
                var obj = jQuery.parseJSON( json );

                if (obj.warning) {
            $("#coupon_code").css({
            "background-color": "#FFD1D1"
             });
                $.gritter.add({
                        title: '{{ text_notification }}',
                        text: obj.warning,
                        class_name:'gritter-warning',
                        sticky: false,
                        time: '3000'
                });
                    $('#confirmLoader').css('display','none');
                    if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.couponBlur=true;
                }
                else{
                        $.gritter.add({
                        title: '{{ text_notification }}',
                        text: '{{ text_coupon_success }}',
                //	image: '',
                        class_name:'gritter-success',
                        sticky: false,
                        time: '3000'
                    });
                           goToConfirmRefresh();
                           
                           
                }

            }
            
        });
    }
}

function callReward(){
      var code=$('#rewards_point').val();
      if(code==""||code==0){
        if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.rewardBlur=true;
        $("#rewards_point").css({
            "background-color": "#FFD1D1"
        });}
        else{
            
        $("#rewards_point").css({
            "background-color": "white"
        });
            $('#confirm').html('<div id="loading" style="text-align:center;"><img src="image/data/checkoutPage/loading_large.gif" width="100" height="100"></div>');
      $('#confirmLoader').css('display','inline-block');
  
        $.ajax({
            type: "POST",
            url: "index.php?route=supercheckout/supercheckout/validateReward",
            data: 'reward='+code,

            success: function(json) {
           var obj = jQuery.parseJSON( json );

                if (obj.warning) {
                     $("#rewards_point").css({
            "background-color": "#FFD1D1"
        });
                $.gritter.add({
                        title: '{{ text_notification }}',
                        text: obj.warning,
                //	image: '',
                        class_name:'gritter-warning',
                        sticky: false,
                        time: '3000'
                });
//                    $('#confirmCheckout .supercheckout-checkout-content').html("");
//                    $('#confirmCheckout .supercheckout-checkout-content').prepend('<div class="warning" style="display: none;">' + obj.warning + '</div>');
//                    $('.supercheckout-checkout-content').show();
//                    $('.warning').fadeIn('slow');
                    $('#confirmLoader').css('display','none');
                    if(window.callconfirm==true){
                        validateCheckout();
                        window.callconfirm=false;
                        window.confirmclick=false;
                    }
                    window.callconfirm=false;
                    window.confirmclick=false;
                    window.rewardBlur=true;
                }
                else{
                    
                    $.gritter.add({
                        title: '{{ text_notification }}',
                        text: '{{ text_reward_success }}',
                //	image: '',
                        class_name:'gritter-success',
                        sticky: false,
                        time: '3000'
                    });
                    validatePaymentMethodRefresh();
                }

            }

        });
    }
}


//    redeeming coupon and voucher
function redeem(id){
    $('#confirm').html('<div id="loading" style="text-align:center;"><img src="image/data/checkoutPage/loading_large.gif" width="100" height="100"></div>');
    $('#confirmLoader').css('display','inline-block');
    $.ajax({
        type: "POST",
        url: "index.php?route=supercheckout/supercheckout/redeem",
        data: 'redeem='+id,
        success: function() {
            $.ajax({
                url: 'index.php?route=supercheckout/confirm',
                dataType: 'html',
                success: function(html) {
                    $('#confirmCheckout').html(html);
                    if(id == 'coupon') {
                        $.gritter.add({
                                title: '{{ text_notification }}',
                                text:  '{{ coupon_deleted }}',
                                class_name:'gritter-success',

                                sticky: false,
                                time: '3000'
                        });
                    } else if(id=='voucher'){
                        $.gritter.add({
                                title: '{{ text_notification }}',
                                text:  '{{ voucher_deleted }}',
                                class_name:'gritter-success',
                                sticky: false,
                                time: '3000'
                        });
                    }
                    else {
                        $.gritter.add({
                                title: '{{ text_notification }}',
                                text:  '{{ reward_deleted }}',
                                class_name:'gritter-success',
                                sticky: false,
                                time: '3000'
                        });
                    }
                    $('#confirmLoader').css('display','none');
                    $.ajax({
                        url: 'index.php?route=supercheckout/payment_display',
                        dataType: 'html',
                        success: function(html) {
                            $('#display_payment').html(html);
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });

                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }

            });
        }

    });
}

    //EDITING CART LIKE REMOVING PRODUCT AND UPDATING QUANTITY
    function removeProduct(id) {
        $('#confirmLoader').css('display','inline-block');
        $.ajax({
            type: "POST",
            url: "index.php?route=supercheckout/supercheckout/cart",
            data: 'remove='+id,
            success: function(msg) {
                if (msg=="Your Cart is empty") {
                    window.location='index.php?route=checkout/cart';
                }
                validateCheckoutRefresh();
                showFreeShippingBannerCalculations();
                window.cart_modified=true;
            }
        });
    }
    
    function updateQuantity(id,operation){
        /*
         Start by dharmanshu for th fix of update quantity 23-10-2020
         */
        var id=id;
        //var quantity = $('#confirmCheckout input[type=\'text\']').val();
        var quantity = $("input[name='quantity["+id+"]']").val();
        console.log($('#confirmCheckout input[type=\'text\']'));
        //return false;
        if(operation =='plus'){
            quantity = ++quantity;
        }else if(operation ='minus'){
            quantity = quantity - 1;
        }
        $('#confirmCheckout input[name="quantity['+id+']"]').val(quantity);
        $('#confirmLoader').css('display','inline-block');
        $.ajax({
            type: "POST",
            url: "index.php?route=supercheckout/supercheckout/cart&quantity",
            data: $('#confirmCheckout input[name="quantity['+id+']"]'),
            success: function(msg){
             if (msg=="Your Cart is empty") 
            {window.location='index.php?route=checkout/cart';}
            validateCheckoutRefresh();
            
            showFreeShippingBannerCalculations();
            window.cart_modified=true;            

            }
        });
        /*
         End by dharmanshu for th fix of update quantity 23-10-2020
         */
    }
    
    // FACEBOOK LOGIN & REGISTERING SCRIPT
    var facebookEnable="{{ settings['step']['facebook_login']['display'] }}";
    if('{{ logged }}'=='' && facebookEnable==1){
        var button;
        var userInfo;
        window.fbAsyncInit = function() {
            FB.init({
                appId: '{{ appId }}', //change the appId to your appId
                status: true,
                cookie: true,
                xfbml: true,
                oauth: true,
                version: 'v2.8'
            });
            function updateButton(response) {
                button       =   document.getElementById('fb-auth');
                userInfo     =   document.getElementById('user-info');
                if (response.authResponse) {
                    button.onclick = function() {
                        FB.logout(function(response) {
                            logout(response);
                            showLoader(true);
                            FB.login(function(response) {
                                if (response.authResponse) {
                                    FB.api('/me?fields=email,first_name,last_name', function(info) {
                                        login(response, info);
                                    });
                                } else {
                                    //user cancelled login or did not grant authorization
                                    showLoader(false);
                                }
                            }, {
                                scope:'email,user_about_me'
                            });
                        });
                    };
                } else {
                    //user is not connected to your app or logged out
                    button.innerHTML = '';
                    button.onclick = function() {
                        showLoader(true);
                        FB.login(function(response) {
                            if (response.authResponse) {
                                FB.api('/me?fields=email,first_name,last_name', function(info) {
                                    login(response, info);
                                });
                            } else {
                                //user cancelled login or did not grant authorization
                                showLoader(false);
                            }
                        }, {
                            scope:'email,user_about_me'
                        });
                    }
                }
            }

            // run once with current status and whenever the status changes
            FB.getLoginStatus(updateButton);
            FB.Event.subscribe('auth.statusChange', updateButton);
        };
        (function() {
            var e = document.createElement('script');
            e.async = true;
            e.src = document.location.protocol
                + '//connect.facebook.net/en_US/all.js';
            document.getElementById('fb-root').appendChild(e);
        }(document, 'script', 'facebook-jssdk'));


        function login(response, info){
            if (response.authResponse) {

                showLoader(false);
                    fqlQuery();
            }
        }
        function logout(response){
            showLoader(false);
        }
        function fqlQuery(){
            showLoader(true);
            FB.api('/me?fields=email,first_name,last_name,gender', function(response) {
                showLoader(false);
//                var query = FB.Data.query('select name,first_name,last_name,email, profile_url, sex, pic_small,contact_email from user where uid={0}', response.id);
                    $.ajax({
                        url: 'index.php?route=supercheckout/supercheckout/checkUser/&email='+response.email,
                        success: function(response2) {
                            if(response2=="registered"){
                                showLoader(true);
                                $.ajax({
                                    url: 'index.php?route=supercheckout/supercheckout/doLogin&emailLogin='+response.email,
                                    success: function(response3) {
                                        window.location='index.php?route=supercheckout/'+response3
                                    },
                                    complete: function(){
                                        showLoader(false);
                                    }
                                });
                            }
                            else{
                                showLoader(true);
                                $.ajax({

                                    url: 'index.php?route=supercheckout/supercheckout/getvalue&firstname='+response.first_name+'&last_name='+response.last_name+'&useremail='+response.email,
                                    success: function(response4) {
                                        window.location='index.php?route=supercheckout/'+response4
                                    },
                                    complete: function(){
                                        showLoader(false);
                                    }
                                });
                            }
                        }
                    });
            });
        }
        function showLoader(status){
            if (status){
                $('#loading-image').show();
            }
            else
                $('#loading-image').hide();
        }

    }

// FOR REFRESHING ALL AT ONCE i.e. PAYMENT METHOD, SHIPPING METHOD, CART AND PAYMENT GATEWAY
function refreshAll(){
//window.confirmclick=true;
    $('#shippingMethodLoader').css('display','inline-block');
    $.ajax({
        url: 'index.php?route=supercheckout/shipping_method',
        dataType: 'html',
        success: function(html) {
            $.ajax({ //shipping_method/validate ajax start here -->patch to update cost in confirm cart
            url: 'index.php?route=supercheckout/shipping_method/validate',
            type: 'post',
            data: $('#shipping-method input[type=\'radio\']:checked'),
            dataType: 'json',
            beforeSend: function() {
                $('#button-shipping-method').attr('disabled', true);
                $('#button-shipping-method').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
            },
            complete: function() {
                $('#button-shipping-method').attr('disabled', false);
                $('.wait').remove();
            },
            success: function(json) {   //shipping_method/validate success start here -->patch to update cost in confirm cart
            
            $('#shipping-method').html(html);
            $('#shippingMethodLoader').css('display','none');
            $('#paymentMethodLoader').css('display','inline-block');
            
            
            $.ajax({
                url: 'index.php?route=supercheckout/payment_method',
                dataType: 'html',
                success: function(html) {
                    $.ajax({ //payment_method/validate ajax start here -->patch to update cost in confirm cart
                    url: 'index.php?route=supercheckout/payment_method/validate',
                    type: 'post',
                    data: $('#payment-method input[type=\'radio\']:checked, #payment-method input[type=\'checkbox\']:checked, #payment-method textarea,#payment_display_block input[type=\'checkbox\']'),
                    dataType: 'json',
                    success: function(json) { //payment_method/validate success start here -->patch to update cost in confirm cart
                    
                        $('#payment-method').html(html);
                        $('#paymentMethodLoader').css('display','none');
                        $('#confirmLoader').css('display','inline-block');
                        $.ajax({
                            url: 'index.php?route=supercheckout/confirm',
                            dataType: 'html',
                            success: function(html) { 

                                $('#confirmLoader').css('display','none');
                                $('#confirmCheckout').html(html);
                                $('#paymentDisable').html("");
                                $.ajax({
                                    url: 'index.php?route=supercheckout/payment_display',
                                    dataType: 'html',
                                    success: function(html) {

                                        $('#display_payment').html(html);
                                        if(window.callconfirm==true){
                                            validateCheckout();
                                            window.callconfirm=false;
                                            window.confirmclick=false;
                                        }
                                        window.callconfirm=false;
                                        window.confirmclick=false;
                                        if(window.cart_modified==true){
                                            $.gritter.add({
                                                title: '{{ text_notification }}',
                                                text: '{{ text_remove }}',
                                                class_name:'gritter-success',
                                                sticky: false,
                                                time: '3000'
                                                });
                                                window.cart_modified=false;
                                        }
                            //            validatePaymentMethodRefresh();

                                    },
                                    error: function(xhr, ajaxOptions, thrownError) {
                                    }
                                });	
                            },
                            error: function(xhr, ajaxOptions, thrownError) {
                            }
                        });	
                    }//payment_method/validate success end here -->patch to update cost in confirm cart
           });//payment_method/validate ajax end here -->patch to update cost in confirm cart
                },//payment method success end here
                error: function(xhr, ajaxOptions, thrownError) {
                }
            });
        } //shipping_method/validate success end here -->patch to update cost in confirm cart
        }); //shipping_method/validate ajax end here -->patch to update cost in confirm cart
        },//shipping method success end here
        error: function(xhr, ajaxOptions, thrownError) {
        }
        
    });
    
        
}

//FOR REFRESHING CART AND PAYMENT GATEWAY IF CHANGE IS MADE IN CART ON BILLING ADDRESS
/*
        Start By dharmnashu for the issue fix of inline validation
    */
    $('#checkoutBillingAddress #payment-new input[type=\'text\']').blur(function () {
         setTimeout(function(){
            cartPaymentRefresh();
        },1000)
    });    
    $('#checkoutBillingAddress #payment-new input[name=\'postcode\']').blur(function () {
        setTimeout(function(){
            validateCheckoutRefresh();
        },1000)
    });
    $('#checkoutShippingAddress #shipping-new input[name=\'postcode\']').blur(function () {
        setTimeout(function(){
            validateCheckoutRefresh();
        },1000)
    });
    
    function cartPaymentRefresh(){
    var guestEnable="{{ settings['step']['login']['option']['guest']['display'] }}";
    var loggedIn="{{ logged }}";
    var registerEnable="{{ settings['general']['guest_manual'] }}";
    if(guestEnable==1)
    {
        if(loggedIn!=""){
            LoginPaymentAddressRefresh();
        }else{
            GuestPaymentAddressRefresh();
        }
    }
    else
    {
        if(loggedIn!=""){
            LoginPaymentAddressRefresh();
        }else if(registerEnable==1){
            GuestPaymentAddressRefresh();
        }
        else{
            $('#checkoutLogin .supercheckout-checkout-content').html('<div class="warning" style="display: none;">' + '{{ please_login_error }}' + '</div>');
            $('#checkoutLogin .supercheckout-checkout-content').show();
            $('.warning').fadeIn('slow');
            goToByScroll('checkoutLogin');
            enableForm();
        }
    }
}
function LoginPaymentAddressRefresh(){
    var paymentAddressEnable="1";
    if(error_status == 0){
        if(paymentAddressEnable==1){
            $.ajax({
                url: 'index.php?route=supercheckout/supercheckout/setValueForLoginPayment',
                type: 'post',
                dataType:'json',
                data: $('#checkoutBillingAddress input[type=\'text\'], #checkoutBillingAddress input[type=\'password\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #checkoutBillingAddress input[type=\'radio\']:checked, #checkoutBillingAddress input[type=\'hidden\'], #checkoutBillingAddress select, #checkoutBillingAddress input[type=\'checkbox\']:checked'),
                beforeSend: function() {
                    $('#button-payment-address').attr('disabled', true);
                    $('#button-payment-address').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                },
                complete: function() {
                    $('#button-payment-address').attr('disabled', false);
                    $('.wait').remove();
                },
                success: function(json) {
                    $('.warning, .errorsmall').remove();
                    if (json['error']){
                        if (json['error']['firstname']) {
                            $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }

                        if (json['error']['email']) {
                            $('#payment-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }
                        if (json['error']['company']) {
                            $('#payment-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                        }
                        if (json['error']['address_1']) {
                            $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                    }else{
                        RefreshCart();
                    }
                }
            });
        }
        else{
            RefreshCart();
        }
    }

}
function GuestPaymentAddressRefresh(){
    var paymentGuestAddressEnable="1";
    var useforShippingEnable="{{ settings['option']['guest']['payment_address']['fields']['shipping']['display'] }}";
    if(error_status == 0){
        console.log('error_status')
        console.log(error_status)
        if(paymentGuestAddressEnable==1){
            if(useforShippingEnable==1){
            
                $.ajax({
                    url: 'index.php?route=supercheckout/supercheckout/setValueForGuestPayment',
                    type: 'post',
                    dataType:'json',
                    data: $('#payment-new  input[type=\'text\'], #checkoutBillingAddress input[type=\'checkbox\']:checked, #payment-new select, #checkoutLogin input[name=\'email\'] '),
                    beforeSend: function() {
                        $('#button-guest').attr('disabled', true);
                        $('#button-guest').after('<span class="wait">&nbsp;<img src="catalog/view/theme/default/image/supercheckout/loading12.gif" alt="" /></span>');
                    },
                    complete: function() {
                        $('#button-guest').attr('disabled', false);
                        $('.wait').remove();
                    },
                    success: function(json) {
                        console.log(json['error'])
                        $('.warning, .errorsmall').remove();
                    if (json['error']){
                        if (json['error']['firstname']) {
                            $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }

                        if (json['error']['email']) {
                            $('#payment-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }
                        if (json['error']['company']) {
                            $('#payment-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                        }
                        if (json['error']['address_1']) {
                            $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                        }else{

                            RefreshCart();
                        }
                    }
                });
            }
            else{
                console.log(4600)
                $.ajax({
                    url: 'index.php?route=supercheckout/supercheckout/setValueForGuestPayment',
                    type: 'post',
                    dataType:'json',
                    data: $('#payment-new  input[type=\'text\'],  #payment-new select'),
                    beforeSend: function() {
                        $('#button-guest').attr('disabled', true);
                        $('#button-guest').after('<span class="wait">&nbsp;<img src="catalog/view/theme/{{ default_theme }}/image/supercheckout/loading12.gif" alt="" /></span>');
                    },
                    complete: function() {
                        $('#button-guest').attr('disabled', false);
                        $('.wait').remove();
                    },
                    success: function(json) {
                    $('.warning, .errorsmall').remove();
                    if (json['error']){
                        if (json['error']['firstname']) {
                            $('#payment-new input[name=\'firstname\']').after('<span class="errorsmall">' + json['error']['firstname'] + '</span>');
                        }
                        
                        if (json['error']['custom_field']) {
                            for( x in json['error']['custom_field'] ){
                                $('#payment-new input[name=\'custom_field['+x+']\']').after('<span class="errorsmall">' + json['error']['custom_field'][x] + '</span>');
                            }
                        }
                        
                        if (json['error']['lastname']) {
                            $('#payment-new input[name=\'lastname\']').after('<span class="errorsmall">' + json['error']['lastname'] + '</span>');
                        }

                        if (json['error']['email']) {
                            $('#payment-new input[name=\'email\']').after('<span class="errorsmall">' + json['error']['email'] + '</span>');
                        }

                        if (json['error']['telephone']) {
                            $('#payment-new input[name=\'telephone\']').after('<span class="errorsmall">' + json['error']['telephone'] + '</span>');
                        }
                        if (json['error']['company']) {
                            $('#payment-new input[name=\'company\']').after('<span class="errorsmall">' + json['error']['company'] + '</span>');
                        }
                        if (json['error']['address_1']) {
                            $('#payment-new input[name=\'address_1\']').after('<span class="errorsmall">' + json['error']['address_1'] + '</span>');
                        }
                        if (json['error']['address_2']) {
                            $('#payment-new input[name=\'address_2\']').after('<span class="errorsmall">' + json['error']['address_2'] + '</span>');
                        }
                        if (json['error']['city']) {
                            $('#payment-new input[name=\'city\']').after('<span class="errorsmall">' + json['error']['city'] + '</span>');
                        }

                        if (json['error']['postcode']) {
                            $('#payment-new input[name=\'postcode\']').after('<span class="errorsmall">' + json['error']['postcode'] + '</span>');
                        }

                        if (json['error']['country']) {
                            $('#payment-new select[name=\'country_id\']').after('<span class="errorsmall">' + json['error']['country'] + '</span>');
                        }

                        if (json['error']['zone']) {
                            $('#payment-new select[name=\'zone_id\']').after('<span class="errorsmall">' + json['error']['zone'] + '</span>');
                        }
                        }else{

                            RefreshCart();
                        }
                    }
                });
            }
        }else{

            RefreshCart();
        }
    }
}

 /*
        End By dharmnashu for the issue fix of inline validation
    */
function RefreshCart(){
    $.ajax({
        url: 'index.php?route=supercheckout/confirm',
        dataType: 'html',
        success: function(html) {
            $('#confirmCheckout').html(html);
//            $('#paymentDisable').html("");
//            $('#confirmCheckout .supercheckout-checkout-content').prepend('<div class="success">{{ text_remove }}</div>');
//            $('.supercheckout-checkout-content').show();
            $('#confirmLoader').css('display','none');

            $.ajax({
                url: 'index.php?route=supercheckout/payment_display',
                dataType: 'html',
                success: function(html) {
                    $('#display_payment').html(html);
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
}

// FOR SUBMITTING ON PRESSING ENTER LIKE LOGIN, COUPON, VOUCHER
$('#email').keypress(function(event){
    if(event.keyCode == 13){
        $('#button-login').click();
    }
});
$('#password').keypress(function(event){    
    if(event.keyCode == 13){
        $('#button-login').click();
    }
});
$('#coupon_code').keypress(function(event){
    if(event.keyCode == 13){
        $('#button-coupon').click();
    }
});
$('#voucher_code').keypress(function(event){
    if(event.keyCode == 13){
        $('#button-voucher').click();
    }
});
$('#rewards_point').keypress(function(event){
    if(event.keyCode == 13){
        $('#button-reward').click();
    }
});
$(document).ready(function(){
    validatePaymentMethodRefresh();
    //payment address sorting
    $('#button-confirm').unbind('click');
{% if (settings['general']['layout'] == '3-Column') %} 
    // FOR SORTING BLOCK AND FIELDS IN SUPERCHECKOUT PAGE

        $('.columnleftsort > .supercheckout-blocks').tsort({
            attr:'data-row'
        });
        $('.columnleftsort > .supercheckout-blocks').each(function(){
            $(this).appendTo('#columnleft-' + $(this).attr('data-column'));

        });

        var $wrapper = $('#payment_address_table');
        $wrapper.find('.sort_data').sort(function (a, b) {
            return +$(a).data("percentage") - + $(b).data("percentage");
        })
        .appendTo( $wrapper );

        //shippping address sorting
        var $wrapper = $('#shipping_address_table');
        $wrapper.find('.sort_data').sort(function (a, b) {
            return +$(a).data("percentage") - + $(b).data("percentage");
        })
        .appendTo( $wrapper );
        //block sorting
    //    $('#button-confirm').unbind('click');
        $('.columnleftsort > .supercheckout-blocks').tsort({
            attr:'data-row'
        });
        $('.columnleftsort > .supercheckout-blocks').each(function(){
            $(this).appendTo('#columnleft-' + $(this).attr('data-column'));

        });

{% elseif (settings['general']['layout'] == '2-Column') %} 
        $('#column-1-inside').css('display','inline-grid');
        $('#column-2-inside').css('display','inline-grid');
        $('.columnleftsort > .supercheckout-blocks').tsort({attr:'col-inside-data'});
        $('.columnleftsort > .supercheckout-blocks').each(function(){
            if($(this).attr('data-column-inside')=="4") {
                $(this).appendTo('#column-2-lower' );
            } else if($(this).attr('data-column-inside')=="3") {
                $(this).appendTo('#column-1-inside' );
            } else if($(this).attr('data-column-inside')=="2") {
                $(this).appendTo('#column-2-upper');
            } else {
                $(this).appendTo('#columnleft-1');
            }
        })
        $('#columnleft-1 > .supercheckout-blocks').tsort({attr:'data-row'});
        $('#columnleft-1 > .supercheckout-blocks').each(function(){
            $(this).appendTo('#columnleft-' + $(this).attr('data-column') );
        })

        $('#column-2-upper > .supercheckout-blocks').tsort({attr:'data-row'});
        $('#column-2-upper > .supercheckout-blocks').each(function(){
            $(this).appendTo('#column-2-upper' );
        })

        $('#column-2-lower > .supercheckout-blocks').tsort({attr:'data-row'});
        $('#column-2-lower > .supercheckout-blocks').each(function(){
            $(this).appendTo('#column-2-lower' );
        })

        $('#column-1-inside > .supercheckout-blocks').tsort({attr:'data-row'});
        $('#column-1-inside > .supercheckout-blocks').each(function() {
            $(this).appendTo('#column-' + $(this).attr('data-column')+'-inside' );
        })

        var $wrapper = $('#payment_address_table');
        $wrapper.find('.sort_data').sort(function (a, b) {
            return +$(a).data("percentage") - + $(b).data("percentage");
        }).appendTo( $wrapper );

        //Shippping Address Sorting
        var $wrapper = $('#shipping_address_table');
        $wrapper.find('.sort_data').sort(function (a, b) {
            return + $(a).data("percentage") - + $(b).data("percentage");
        }).appendTo( $wrapper );

{% elseif (settings['general']['layout'] == '1-Column') %} 
        $('#columnleft-1 > .supercheckout-blocks').tsort({attr:'data-row'});
        $('#columnleft-1 > .supercheckout-blocks').each(function() {
            $(this).appendTo('#columnleft-1' );
        }); 
{% endif %} 
}); 
$(document).ready(function(){

{% if (layout_name == 'three-column') %} 
        var a = $('#supercheckout-columnleft').height(); 
        var d = $('#supercheckout_login_option_box').height();  
        var e = a-d;
        $('#columnleft-1').css('min-height', e + 'px');
        $('#columnleft-3').css('min-height', e + 'px');
        
        
{% elseif (layout_name == 'two-column') %} 
        var a = $('#supercheckout-columnleft').height();    
        var d = $('#supercheckout_login_option_box').height();  
        var e = a-d;
        $('#columnleft-1').css('min-height', e + 'px');
        var b = $('#column-1-inside').height();
        var c = $('#column-2-inside').height();
        if(c > b) {
            $('#column-1-inside').css('min-height', c + 'px');
        } else {
            $('#column-2-inside').css('min-height', b + 'px');
        }
{% endif %} 
});
</script>
 
<script>
var button_width = $('#confirm_order').width() + 76;

$('#progressbar').css('width', button_width + 'px');

$(window).bind('beforeunload', function() {
       try {
           document.getElementById("shipping_address_id_custom").selectedIndex = -1;
           document.getElementById("payment_address_id_custom").selectedIndex = -1;
       } catch(e) {
            
       }
       $("#payment-address-new").removeAttr("checked");
       $("#payment-address-existing").attr("checked", "checked");
       $("#shipping-address-new").removeAttr("checked");
       $("#shipping-address-existing").attr("checked", "checked");
});

function disableForm(){
   var fieldset_width = $('#supercheckout-fieldset').width();
   var fieldset_height = $('#supercheckout-fieldset').height();
   $('#form_disable').show();
   $('#form_disable').css('width',fieldset_width +'px');
   $('#form_disable').css('height',fieldset_height +'px');
}

function enableForm(){
   $('#form_disable').hide();
}
$(document).ready(function(){
$('[data-toggle="popover"]').popover();
});

$('.date').datetimepicker({
        pickTime: false,
 //       widgetParent: '.date'
//        container:'.date'
});

$('.time').datetimepicker({
        pickDate: false,
        minuteStepping: 15
});	

$('.datetime').datetimepicker({
        pickDate: true,
        pickTime: true
});

</script>

<script>
$('input[name=\'customer_group_id\']').on('change', function() {
	$.ajax({
            url: 'index.php?route=account/register/customfield&customer_group_id=' + this.value,
            dataType: 'json',
            success: function(json) {
                console.log(json);
                
                $('.custom-field').hide();
              //    $('.address_custom_field').attr('name', 'custom_field');
                    $('.custom-field').removeClass('required');
                    $('.account_custom_field').removeAttr('data');
                    
                    
                    for (i = 0; i < json.length; i++) {
                        custom_field = json[i];

                        var loggedIn="{{ logged }}";
                        js_array = {{ settings|json_encode|raw }};

                        var custom_field_visible = 0;
                        var custom_field_visible_payment = 0;

                        if(js_array['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']] != undefined){

                        if(loggedIn!=""){
custom_field_visible = js_array['option']['logged']['shipping_address']['fields'][custom_field['custom_field_id']]['display'];
}else{
custom_field_visible = js_array['option']['guest']['shipping_address']['fields'][custom_field['custom_field_id']]['display'];
}
}

if(js_array['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']] != undefined){

if(loggedIn!=""){
custom_field_visible_payment = js_array['option']['logged']['payment_address']['fields'][custom_field['custom_field_id']]['display'];

}else{
custom_field_visible_payment = js_array['option']['guest']['payment_address']['fields'][custom_field['custom_field_id']]['display'];
}
}
$('#custom-field' + custom_field['custom_field_id']).show();

if(custom_field_visible == 1){
$('#shipping_custom-field' + custom_field['custom_field_id']).show();
$('#input-shipping-custom-field' + custom_field['custom_field_id']).show();
}
if(custom_field_visible_payment == 1){
//$('#payment_custom-field' + custom_field['custom_field_id']).show();
$('#input-payment-custom-field' + custom_field['custom_field_id']).show();
}

                        if (custom_field['required']) {
                           $('#custom-field' + custom_field['custom_field_id']).addClass('required');
$('.display_required' + custom_field['custom_field_id']).show();
$('#input-payment-custom-field' + custom_field['custom_field_id']).attr('data','required');
$('#input-shipping-custom-field' + custom_field['custom_field_id']).attr('data','required');
}
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
});

</script>

<script>
    
    $(document).ready(function(){
    
        showFreeShippingBannerCalculations();
       $('#customer-groups1').trigger("click");  
    });
</script>
    
<script>
        

function showFreeShippingBannerCalculations(){
    $.ajax({
        url: 'index.php?route=supercheckout/supercheckout/showFreeShippingBannerCalculations',
        dataType:"json",
        success: function(json) {
        var hidden_amount = json.hidden_amount;
        if(json.free_shipping_amount > 0) {
            var kb_free_shipping_amount_with_symbol = json.kb_free_shipping_amount_with_symbol;
            var kb_free_shipping_percent = json.kb_free_shipping_percent; 
            if(hidden_amount == 0){
                var html = '<h3>{{ text_reached_minimum_amount }} </h3>';
            } else {
                var html = '<h3>{{ text_remaining_amount }}</h3>';
            }

            var replacedHtml = html.replace(/%s/, kb_free_shipping_amount_with_symbol); 

            replacedHtml += '<div class="progress"><div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:'+kb_free_shipping_percent+'%;flex:'+kb_free_shipping_percent+'%;max-width:'+kb_free_shipping_percent+'%;">'+kb_free_shipping_percent+'% {{ complete_success }} </div> </div>';
        
            $('.freeShipping').html(replacedHtml);
            }
        }
        
    });
}
</script>

{% if (settings['autofill_address']['enable'] == 1) %} 
<script type="text/javascript">
window.onload = function (e) {
    var script = document.createElement('script');
    script.src = "https://maps.googleapis.com/maps/api/js?key={{settings['autofill_address']['api']}}&libraries=places&callback=initAutocomplete";
    document.getElementsByTagName('script')[0].parentNode.appendChild(script);
}

var placeSearch;
var autocomplete = {};
var autocompleteLsr = {};
// Create the autocomplete object, restricting the search to geographical
// location types.     
var autocompletesWraps = [{name: ['shipping_address_1', 'shipping_address_2'], form: 'shipping-new'}, {name: ['address_1', 'address_2'], form: 'payment-new'}];
var autocompletesWraps = [{name: ['shipping_address_1', 'shipping_address_2'], form: 'shipping-new'}, {name: ['address_1', 'address_2'], form: 'payment-new'}];
var shipping_address_1_field = {premise: 'short_name', street_number: 'short_name', route: 'long_name', locality: 'long_name', administrative_area_level_1: 'short_name', country: 'short_name', postal_code: 'short_name'};
var shipping_address_2_field = {premise: 'short_name', street_number: 'short_name', route: 'long_name', locality: 'long_name', administrative_area_level_1: 'short_name', country: 'short_name', postal_code: 'short_name'};
var address_1_field = {premise: 'short_name', street_number: 'short_name', route: 'long_name', locality: 'long_name', administrative_area_level_1: 'short_name', country: 'short_name', postal_code: 'short_name'};
var address_1_field = {premise: 'short_name', street_number: 'short_name', route: 'long_name', locality: 'long_name', administrative_area_level_1: 'short_name', country: 'short_name', postal_code: 'short_name'};
var shipping_selected_iso = '';
var payment_selected_iso = '';

function initAutocomplete() {
    payment_selected_iso = [];
    shipping_selected_iso = [];
    payment_selected_iso.push($('#payment-new select[name=country_id] option:selected').attr("class").toLowerCase());
    shipping_selected_iso.push($('#shipping-new select[name=country_id] option:selected').attr("class").toLowerCase());
    $.each(autocompletesWraps, function (index, wraps) {
        $.each(wraps.name, function (index, name) {
            if ($('#' + name).length == 0) {
                return;
            }
            autocomplete[name] = new google.maps.places.Autocomplete($('#' + name)[0], {types: ['geocode']});
            if(name == "shipping_address_1" || name == 'shipping_address_2') {
                autocomplete[name].setComponentRestrictions({'country':  shipping_selected_iso});
            } else {
                autocomplete[name].setComponentRestrictions({'country': payment_selected_iso});
            } 
            
            autocompleteLsr[name] = google.maps.event.addListener(autocomplete[name], 'place_changed', function () {
                var place = autocomplete[name].getPlace();
                var field = eval(name + '_field');
                var address_line_1_value = '';
                var address_line_2_value = '';
                for (var i = 0; i < place.address_components.length; i++) {
                    var addressType = place.address_components[i].types[0];
                    if (typeof field[addressType] !== 'undefined') {
                        var val = place.address_components[i][field[addressType]];
                        if (addressType == 'postal_code') {
                            $('#' + wraps.form + ' input[name="postcode"]').val(val);
                            $('#' + wraps.form + ' input[name="postcode"]').trigger("blur");
                        } else if (addressType == 'premise' || addressType == 'street_number') {
                            if(val != "") {
                                address_line_1_value = address_line_1_value + " " + val;
                            } else {
                                address_line_1_value = val;
                            }
                            $('#' + wraps.form + ' input[name="address_1"]').trigger("blur");
                        } else if (addressType == 'route') {
                            address_line_2_value = val;
                            $('#' + wraps.form + ' input[name="address_2"]').trigger("blur");
                        } else if (addressType == 'locality') {
                            $('#' + wraps.form + ' input[name="city"]').val(val);
                            $('#' + wraps.form + ' input[name="city"]').trigger("blur");
                        } else if (addressType == 'country') {


                        } else if (addressType == 'administrative_area_level_1') {
                            var state_id_to_select = $('#' + wraps.form + ' select[name="zone_id"]').find("." + val).val();
                            $('#' + wraps.form + ' select[name="zone_id"]').val(state_id_to_select);
                            $('#' + wraps.form + ' select[name="zone_id"]').trigger("blur");
                        }
                    }
                }
                
                /* If address line 2 is hidden then save the value of the address2 in line itself */
                if($('#' + wraps.form + ' input[name="address_2"]').parent().parent().css("display") == "none") {
                    if(address_line_2_value != "") {
                        address_line_1_value = address_line_1_value + " " + address_line_2_value;
                    }
                    $('#' + wraps.form + ' input[name="address_1"]').val(address_line_1_value);                    
                } else {
                    $('#' + wraps.form + ' input[name="address_1"]').val(address_line_1_value);
                    $('#' + wraps.form + ' input[name="address_2"]').val(address_line_2_value);
                }
            });
        });
    });
}
</script>
{% endif %} 
<script>
//by dharmanshu
    var error_status = 0;
</script>
    
{% if (settings['step']['inlinevalidation'] == '1') %} 
<script>       
$('input[name="email"]').blur(function(){

    $('.inlinevalidateerror_email').text('');
    var val = $(this).val();
    if(val.trim() == ''){
        var error_msg = "{{ error_required }}";
        $(this).after('<p style="color:red !important;" class="inlinevalidateerror_email">'+ error_msg +'</p>');    
        return false;
    }
    if(!validateEmailAddr(val)){
        var error_msg = "{{ error_email }}";
        $(this).after('<p style="color:red !important;" class="inlinevalidateerror_email">'+ error_msg +'</p>'); 
        return false;
    }
});

$('input[name^="custom_field"]').blur(function(){
//debugger;
    $('.inlinevalidateerror_custom_field').text('');
    var val = $(this).val();
    if(val.trim() == ''){
        var error_msg = "{{ error_required }}";
        $(this).after('<p style="color:red !important;" class="inlinevalidateerror_custom_field">'+ error_msg +'</p>');    
        return false;
    }
});

$('input[name="firstname"]').blur(function(){

    $('.inlinevalidateerror_firstname').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['firstname']['require'] }}';
    if(required == 1){
        
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_firstname">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validateName(val)){
            var error_msg = "{{ error_numeric }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_firstname">'+ error_msg +'</p>'); 
            return false;
        }
    }
});

$('input[name="lastname"]').blur(function(){
    $('.inlinevalidateerror_lastname').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['lastname']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_lastname">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validateName(val)){
            var error_msg = "{{ error_numeric }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_lastname">'+ error_msg +'</p>'); 
            return false;
        }
    }

});

$('input[name="telephone"]').blur(function(){
    $('.inlinevalidateerror_telephone').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['telephone']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_telephone">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validatePhoneNumber(val)){
            var error_msg = "{{ error_phonenumber }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_telephone">'+ error_msg +'</p>'); 
            return false;
        }
    }

});

$('input[name="address_1"]').blur(function(){
    $('.warning_address_1').text('');
    $('.inlinevalidateerror_address_1').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['address_1']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_address_1">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validateAddress(val)){
            var error_msg = "{{ error_address }}";
            $(this).after('<p style="color:orange !important;" class="warning_address_1">'+ error_msg +'</p>'); 
            return false;
        }
    }
});

$('input[name="address_2"]').blur(function(){
    $('.warning_address_2').text('');
    $('.inlinevalidateerror_address_2').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['address_2']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_address_2">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validateAddress(val)){
            var error_msg = "{{ error_address }}";
            $(this).after('<p style="color:orange !important;" class="warning_address_2">'+ error_msg +'</p>'); 
            return false;
        }
    }
});


$('input[name="city"]').blur(function(){
    $('.inlinevalidateerror_city').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['city']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_city">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validateCityName(val)){
            var error_msg = "{{ error_address }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_city">'+ error_msg +'</p>'); 
            return false;
        }
    }

});

$('input[name="postcode"]').blur(function(){
    $('.inlinevalidateerror_postcode').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['postcode']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_postcode">'+ error_msg +'</p>');    
            return false;
        }
    }
    if(val != ''){
        if(!validatePinCode(val)){
            var error_msg = "{{ error_pincode }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_postcode">'+ error_msg +'</p>'); 
            return false;
        }
    }

});

$('select[name="zone_id"]').blur(function(){
    $('.inlinevalidateerror_zone_id').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['zone_id']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_zone_id">'+ error_msg +'</p>');    
            return false;
        }
    }
});

$('select[name="country_id"]').blur(function(){
    $('.inlinevalidateerror_country_id').text('');
    var val = $(this).val();
    var required = '{{ settings['option']['logged']['payment_address']['fields']['country_id']['require'] }}';
    if(required == 1){
        if(val.trim() == ''){
            error_status = 1;
            var error_msg = "{{ error_required }}";
            $(this).after('<p style="color:red !important;" class="inlinevalidateerror_country_id">'+ error_msg +'</p>');    
            return false;
        }
    }
});


function validateName(s) {
    var reg = /^[^0-9!<>,;?=+()@#"ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â°{}_$%:]+$/;
    return reg.test(s);
}

function validatePhoneNumber(s) {
    var reg = /^[+0-9. ()-]+$/;
    return reg.test(s);
}

function validatePinCode(s) {
    var reg = /^[+0-9. ()-]+$/;
    return reg.test(s);
}

function validateAddress(s) {
    var reg = /^[^!<>?=+@{}_$%]+$/;
    return reg.test(s);
}

function validateCityName(s) {
    var reg = /^[^!<>;?=+@#"ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Â°{}_$%]+$/;
    return reg.test(s);
}

function validateEmailAddr(s) {
    var reg = unicode_hack(/^[a-z\p{L}0-9!#$%&'*+\/=?^`{}|~_-]+[.a-z\p{L}0-9!#$%&'*+\/=?^`{}|~_-]*@[a-z\p{L}0-9]+[._a-z\p{L}0-9-]*\.[a-z\p{L}0-9]+$/i, false);
    return reg.test(s);
}

var unicode_hack = (function() {
    /* Regexps to match characters in the BMP according to their Unicode category.
     Extracted from Unicode specification, version 5.0.0, source:
     http://unicode.org/versions/Unicode5.0.0/
     */
    var unicodeCategories = {
        Pi: '[\u00ab\u2018\u201b\u201c\u201f\u2039\u2e02\u2e04\u2e09\u2e0c\u2e1c]',
        Sk: '[\u005e\u0060\u00a8\u00af\u00b4\u00b8\u02c2-\u02c5\u02d2-\u02df\u02e5-\u02ed\u02ef-\u02ff\u0374\u0375\u0384\u0385\u1fbd\u1fbf-\u1fc1\u1fcd-\u1fcf\u1fdd-\u1fdf\u1fed-\u1fef\u1ffd\u1ffe\u309b\u309c\ua700-\ua716\ua720\ua721\uff3e\uff40\uffe3]',
        Sm: '[\u002b\u003c-\u003e\u007c\u007e\u00ac\u00b1\u00d7\u00f7\u03f6\u2044\u2052\u207a-\u207c\u208a-\u208c\u2140-\u2144\u214b\u2190-\u2194\u219a\u219b\u21a0\u21a3\u21a6\u21ae\u21ce\u21cf\u21d2\u21d4\u21f4-\u22ff\u2308-\u230b\u2320\u2321\u237c\u239b-\u23b3\u23dc-\u23e1\u25b7\u25c1\u25f8-\u25ff\u266f\u27c0-\u27c4\u27c7-\u27ca\u27d0-\u27e5\u27f0-\u27ff\u2900-\u2982\u2999-\u29d7\u29dc-\u29fb\u29fe-\u2aff\ufb29\ufe62\ufe64-\ufe66\uff0b\uff1c-\uff1e\uff5c\uff5e\uffe2\uffe9-\uffec]',
        So: '[\u00a6\u00a7\u00a9\u00ae\u00b0\u00b6\u0482\u060e\u060f\u06e9\u06fd\u06fe\u07f6\u09fa\u0b70\u0bf3-\u0bf8\u0bfa\u0cf1\u0cf2\u0f01-\u0f03\u0f13-\u0f17\u0f1a-\u0f1f\u0f34\u0f36\u0f38\u0fbe-\u0fc5\u0fc7-\u0fcc\u0fcf\u1360\u1390-\u1399\u1940\u19e0-\u19ff\u1b61-\u1b6a\u1b74-\u1b7c\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211e-\u2123\u2125\u2127\u2129\u212e\u213a\u213b\u214a\u214c\u214d\u2195-\u2199\u219c-\u219f\u21a1\u21a2\u21a4\u21a5\u21a7-\u21ad\u21af-\u21cd\u21d0\u21d1\u21d3\u21d5-\u21f3\u2300-\u2307\u230c-\u231f\u2322-\u2328\u232b-\u237b\u237d-\u239a\u23b4-\u23db\u23e2-\u23e7\u2400-\u2426\u2440-\u244a\u249c-\u24e9\u2500-\u25b6\u25b8-\u25c0\u25c2-\u25f7\u2600-\u266e\u2670-\u269c\u26a0-\u26b2\u2701-\u2704\u2706-\u2709\u270c-\u2727\u2729-\u274b\u274d\u274f-\u2752\u2756\u2758-\u275e\u2761-\u2767\u2794\u2798-\u27af\u27b1-\u27be\u2800-\u28ff\u2b00-\u2b1a\u2b20-\u2b23\u2ce5-\u2cea\u2e80-\u2e99\u2e9b-\u2ef3\u2f00-\u2fd5\u2ff0-\u2ffb\u3004\u3012\u3013\u3020\u3036\u3037\u303e\u303f\u3190\u3191\u3196-\u319f\u31c0-\u31cf\u3200-\u321e\u322a-\u3243\u3250\u3260-\u327f\u328a-\u32b0\u32c0-\u32fe\u3300-\u33ff\u4dc0-\u4dff\ua490-\ua4c6\ua828-\ua82b\ufdfd\uffe4\uffe8\uffed\uffee\ufffc\ufffd]',
        Po: '[\u0021-\u0023\u0025-\u0027\u002a\u002c\u002e\u002f\u003a\u003b\u003f\u0040\u005c\u00a1\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05be\u05c0\u05c3\u05c6\u05f3\u05f4\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964\u0965\u0970\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f85\u0fd0\u0fd1\u104a-\u104f\u10fb\u1361-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u19de\u19df\u1a1e\u1a1f\u1b5a-\u1b60\u2016\u2017\u2020-\u2027\u2030-\u2038\u203b-\u203e\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205e\u2cf9-\u2cfc\u2cfe\u2cff\u2e00\u2e01\u2e06-\u2e08\u2e0b\u2e0e-\u2e16\u3001-\u3003\u303d\u30fb\ua874-\ua877\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]',
        Mn: '[\u0300-\u036f\u0483-\u0486\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u0615\u064b-\u065e\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0901\u0902\u093c\u0941-\u0948\u094d\u0951-\u0954\u0962\u0963\u0981\u09bc\u09c1-\u09c4\u09cd\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a70\u0a71\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3f\u0b41-\u0b43\u0b4d\u0b56\u0b82\u0bc0\u0bcd\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0cbc\u0cbf\u0cc6\u0ccc\u0ccd\u0ce2\u0ce3\u0d41-\u0d43\u0d4d\u0dca\u0dd2-\u0dd4\u0dd6\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032\u1036\u1037\u1039\u1058\u1059\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1dc0-\u1dca\u1dfe\u1dff\u20d0-\u20dc\u20e1\u20e5-\u20ef\u302a-\u302f\u3099\u309a\ua806\ua80b\ua825\ua826\ufb1e\ufe00-\ufe0f\ufe20-\ufe23]',
        Ps: '[\u0028\u005b\u007b\u0f3a\u0f3c\u169b\u201a\u201e\u2045\u207d\u208d\u2329\u2768\u276a\u276c\u276e\u2770\u2772\u2774\u27c5\u27e6\u27e8\u27ea\u2983\u2985\u2987\u2989\u298b\u298d\u298f\u2991\u2993\u2995\u2997\u29d8\u29da\u29fc\u3008\u300a\u300c\u300e\u3010\u3014\u3016\u3018\u301a\u301d\ufd3e\ufe17\ufe35\ufe37\ufe39\ufe3b\ufe3d\ufe3f\ufe41\ufe43\ufe47\ufe59\ufe5b\ufe5d\uff08\uff3b\uff5b\uff5f\uff62]',
        Cc: '[\u0000-\u001f\u007f-\u009f]',
        Cf: '[\u00ad\u0600-\u0603\u06dd\u070f\u17b4\u17b5\u200b-\u200f\u202a-\u202e\u2060-\u2063\u206a-\u206f\ufeff\ufff9-\ufffb]',
        Ll: '[\u0061-\u007a\u00aa\u00b5\u00ba\u00df-\u00f6\u00f8-\u00ff\u0101\u0103\u0105\u0107\u0109\u010b\u010d\u010f\u0111\u0113\u0115\u0117\u0119\u011b\u011d\u011f\u0121\u0123\u0125\u0127\u0129\u012b\u012d\u012f\u0131\u0133\u0135\u0137\u0138\u013a\u013c\u013e\u0140\u0142\u0144\u0146\u0148\u0149\u014b\u014d\u014f\u0151\u0153\u0155\u0157\u0159\u015b\u015d\u015f\u0161\u0163\u0165\u0167\u0169\u016b\u016d\u016f\u0171\u0173\u0175\u0177\u017a\u017c\u017e-\u0180\u0183\u0185\u0188\u018c\u018d\u0192\u0195\u0199-\u019b\u019e\u01a1\u01a3\u01a5\u01a8\u01aa\u01ab\u01ad\u01b0\u01b4\u01b6\u01b9\u01ba\u01bd-\u01bf\u01c6\u01c9\u01cc\u01ce\u01d0\u01d2\u01d4\u01d6\u01d8\u01da\u01dc\u01dd\u01df\u01e1\u01e3\u01e5\u01e7\u01e9\u01eb\u01ed\u01ef\u01f0\u01f3\u01f5\u01f9\u01fb\u01fd\u01ff\u0201\u0203\u0205\u0207\u0209\u020b\u020d\u020f\u0211\u0213\u0215\u0217\u0219\u021b\u021d\u021f\u0221\u0223\u0225\u0227\u0229\u022b\u022d\u022f\u0231\u0233-\u0239\u023c\u023f\u0240\u0242\u0247\u0249\u024b\u024d\u024f-\u0293\u0295-\u02af\u037b-\u037d\u0390\u03ac-\u03ce\u03d0\u03d1\u03d5-\u03d7\u03d9\u03db\u03dd\u03df\u03e1\u03e3\u03e5\u03e7\u03e9\u03eb\u03ed\u03ef-\u03f3\u03f5\u03f8\u03fb\u03fc\u0430-\u045f\u0461\u0463\u0465\u0467\u0469\u046b\u046d\u046f\u0471\u0473\u0475\u0477\u0479\u047b\u047d\u047f\u0481\u048b\u048d\u048f\u0491\u0493\u0495\u0497\u0499\u049b\u049d\u049f\u04a1\u04a3\u04a5\u04a7\u04a9\u04ab\u04ad\u04af\u04b1\u04b3\u04b5\u04b7\u04b9\u04bb\u04bd\u04bf\u04c2\u04c4\u04c6\u04c8\u04ca\u04cc\u04ce\u04cf\u04d1\u04d3\u04d5\u04d7\u04d9\u04db\u04dd\u04df\u04e1\u04e3\u04e5\u04e7\u04e9\u04eb\u04ed\u04ef\u04f1\u04f3\u04f5\u04f7\u04f9\u04fb\u04fd\u04ff\u0501\u0503\u0505\u0507\u0509\u050b\u050d\u050f\u0511\u0513\u0561-\u0587\u1d00-\u1d2b\u1d62-\u1d77\u1d79-\u1d9a\u1e01\u1e03\u1e05\u1e07\u1e09\u1e0b\u1e0d\u1e0f\u1e11\u1e13\u1e15\u1e17\u1e19\u1e1b\u1e1d\u1e1f\u1e21\u1e23\u1e25\u1e27\u1e29\u1e2b\u1e2d\u1e2f\u1e31\u1e33\u1e35\u1e37\u1e39\u1e3b\u1e3d\u1e3f\u1e41\u1e43\u1e45\u1e47\u1e49\u1e4b\u1e4d\u1e4f\u1e51\u1e53\u1e55\u1e57\u1e59\u1e5b\u1e5d\u1e5f\u1e61\u1e63\u1e65\u1e67\u1e69\u1e6b\u1e6d\u1e6f\u1e71\u1e73\u1e75\u1e77\u1e79\u1e7b\u1e7d\u1e7f\u1e81\u1e83\u1e85\u1e87\u1e89\u1e8b\u1e8d\u1e8f\u1e91\u1e93\u1e95-\u1e9b\u1ea1\u1ea3\u1ea5\u1ea7\u1ea9\u1eab\u1ead\u1eaf\u1eb1\u1eb3\u1eb5\u1eb7\u1eb9\u1ebb\u1ebd\u1ebf\u1ec1\u1ec3\u1ec5\u1ec7\u1ec9\u1ecb\u1ecd\u1ecf\u1ed1\u1ed3\u1ed5\u1ed7\u1ed9\u1edb\u1edd\u1edf\u1ee1\u1ee3\u1ee5\u1ee7\u1ee9\u1eeb\u1eed\u1eef\u1ef1\u1ef3\u1ef5\u1ef7\u1ef9\u1f00-\u1f07\u1f10-\u1f15\u1f20-\u1f27\u1f30-\u1f37\u1f40-\u1f45\u1f50-\u1f57\u1f60-\u1f67\u1f70-\u1f7d\u1f80-\u1f87\u1f90-\u1f97\u1fa0-\u1fa7\u1fb0-\u1fb4\u1fb6\u1fb7\u1fbe\u1fc2-\u1fc4\u1fc6\u1fc7\u1fd0-\u1fd3\u1fd6\u1fd7\u1fe0-\u1fe7\u1ff2-\u1ff4\u1ff6\u1ff7\u2071\u207f\u210a\u210e\u210f\u2113\u212f\u2134\u2139\u213c\u213d\u2146-\u2149\u214e\u2184\u2c30-\u2c5e\u2c61\u2c65\u2c66\u2c68\u2c6a\u2c6c\u2c74\u2c76\u2c77\u2c81\u2c83\u2c85\u2c87\u2c89\u2c8b\u2c8d\u2c8f\u2c91\u2c93\u2c95\u2c97\u2c99\u2c9b\u2c9d\u2c9f\u2ca1\u2ca3\u2ca5\u2ca7\u2ca9\u2cab\u2cad\u2caf\u2cb1\u2cb3\u2cb5\u2cb7\u2cb9\u2cbb\u2cbd\u2cbf\u2cc1\u2cc3\u2cc5\u2cc7\u2cc9\u2ccb\u2ccd\u2ccf\u2cd1\u2cd3\u2cd5\u2cd7\u2cd9\u2cdb\u2cdd\u2cdf\u2ce1\u2ce3\u2ce4\u2d00-\u2d25\ufb00-\ufb06\ufb13-\ufb17\uff41-\uff5a]',
        Lm: '[\u02b0-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ee\u037a\u0559\u0640\u06e5\u06e6\u07f4\u07f5\u07fa\u0e46\u0ec6\u10fc\u17d7\u1843\u1d2c-\u1d61\u1d78\u1d9b-\u1dbf\u2090-\u2094\u2d6f\u3005\u3031-\u3035\u303b\u309d\u309e\u30fc-\u30fe\ua015\ua717-\ua71a\uff70\uff9e\uff9f]',
        Lo: '[\u01bb\u01c0-\u01c3\u0294\u05d0-\u05ea\u05f0-\u05f2\u0621-\u063a\u0641-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u076d\u0780-\u07a5\u07b1\u07ca-\u07ea\u0904-\u0939\u093d\u0950\u0958-\u0961\u097b-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d60\u0d61\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e45\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0edc\u0edd\u0f00\u0f40-\u0f47\u0f49-\u0f6a\u0f88-\u0f8b\u1000-\u1021\u1023-\u1027\u1029\u102a\u1050-\u1055\u10d0-\u10fa\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17dc\u1820-\u1842\u1844-\u1877\u1880-\u18a8\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u2135-\u2138\u2d30-\u2d65\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3006\u303c\u3041-\u3096\u309f\u30a1-\u30fa\u30ff\u3105-\u312c\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400\u4db5\u4e00\u9fbb\ua000-\ua014\ua016-\ua48c\ua800\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\uac00\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff66-\uff6f\uff71-\uff9d\uffa0-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]',
        Co: '[\ue000\uf8ff]',
        Nd: '[\u0030-\u0039\u0660-\u0669\u06f0-\u06f9\u07c0-\u07c9\u0966-\u096f\u09e6-\u09ef\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be6-\u0bef\u0c66-\u0c6f\u0ce6-\u0cef\u0d66-\u0d6f\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29\u1040-\u1049\u17e0-\u17e9\u1810-\u1819\u1946-\u194f\u19d0-\u19d9\u1b50-\u1b59\uff10-\uff19]',
        Lt: '[\u01c5\u01c8\u01cb\u01f2\u1f88-\u1f8f\u1f98-\u1f9f\u1fa8-\u1faf\u1fbc\u1fcc\u1ffc]',
        Lu: '[\u0041-\u005a\u00c0-\u00d6\u00d8-\u00de\u0100\u0102\u0104\u0106\u0108\u010a\u010c\u010e\u0110\u0112\u0114\u0116\u0118\u011a\u011c\u011e\u0120\u0122\u0124\u0126\u0128\u012a\u012c\u012e\u0130\u0132\u0134\u0136\u0139\u013b\u013d\u013f\u0141\u0143\u0145\u0147\u014a\u014c\u014e\u0150\u0152\u0154\u0156\u0158\u015a\u015c\u015e\u0160\u0162\u0164\u0166\u0168\u016a\u016c\u016e\u0170\u0172\u0174\u0176\u0178\u0179\u017b\u017d\u0181\u0182\u0184\u0186\u0187\u0189-\u018b\u018e-\u0191\u0193\u0194\u0196-\u0198\u019c\u019d\u019f\u01a0\u01a2\u01a4\u01a6\u01a7\u01a9\u01ac\u01ae\u01af\u01b1-\u01b3\u01b5\u01b7\u01b8\u01bc\u01c4\u01c7\u01ca\u01cd\u01cf\u01d1\u01d3\u01d5\u01d7\u01d9\u01db\u01de\u01e0\u01e2\u01e4\u01e6\u01e8\u01ea\u01ec\u01ee\u01f1\u01f4\u01f6-\u01f8\u01fa\u01fc\u01fe\u0200\u0202\u0204\u0206\u0208\u020a\u020c\u020e\u0210\u0212\u0214\u0216\u0218\u021a\u021c\u021e\u0220\u0222\u0224\u0226\u0228\u022a\u022c\u022e\u0230\u0232\u023a\u023b\u023d\u023e\u0241\u0243-\u0246\u0248\u024a\u024c\u024e\u0386\u0388-\u038a\u038c\u038e\u038f\u0391-\u03a1\u03a3-\u03ab\u03d2-\u03d4\u03d8\u03da\u03dc\u03de\u03e0\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03f9\u03fa\u03fd-\u042f\u0460\u0462\u0464\u0466\u0468\u046a\u046c\u046e\u0470\u0472\u0474\u0476\u0478\u047a\u047c\u047e\u0480\u048a\u048c\u048e\u0490\u0492\u0494\u0496\u0498\u049a\u049c\u049e\u04a0\u04a2\u04a4\u04a6\u04a8\u04aa\u04ac\u04ae\u04b0\u04b2\u04b4\u04b6\u04b8\u04ba\u04bc\u04be\u04c0\u04c1\u04c3\u04c5\u04c7\u04c9\u04cb\u04cd\u04d0\u04d2\u04d4\u04d6\u04d8\u04da\u04dc\u04de\u04e0\u04e2\u04e4\u04e6\u04e8\u04ea\u04ec\u04ee\u04f0\u04f2\u04f4\u04f6\u04f8\u04fa\u04fc\u04fe\u0500\u0502\u0504\u0506\u0508\u050a\u050c\u050e\u0510\u0512\u0531-\u0556\u10a0-\u10c5\u1e00\u1e02\u1e04\u1e06\u1e08\u1e0a\u1e0c\u1e0e\u1e10\u1e12\u1e14\u1e16\u1e18\u1e1a\u1e1c\u1e1e\u1e20\u1e22\u1e24\u1e26\u1e28\u1e2a\u1e2c\u1e2e\u1e30\u1e32\u1e34\u1e36\u1e38\u1e3a\u1e3c\u1e3e\u1e40\u1e42\u1e44\u1e46\u1e48\u1e4a\u1e4c\u1e4e\u1e50\u1e52\u1e54\u1e56\u1e58\u1e5a\u1e5c\u1e5e\u1e60\u1e62\u1e64\u1e66\u1e68\u1e6a\u1e6c\u1e6e\u1e70\u1e72\u1e74\u1e76\u1e78\u1e7a\u1e7c\u1e7e\u1e80\u1e82\u1e84\u1e86\u1e88\u1e8a\u1e8c\u1e8e\u1e90\u1e92\u1e94\u1ea0\u1ea2\u1ea4\u1ea6\u1ea8\u1eaa\u1eac\u1eae\u1eb0\u1eb2\u1eb4\u1eb6\u1eb8\u1eba\u1ebc\u1ebe\u1ec0\u1ec2\u1ec4\u1ec6\u1ec8\u1eca\u1ecc\u1ece\u1ed0\u1ed2\u1ed4\u1ed6\u1ed8\u1eda\u1edc\u1ede\u1ee0\u1ee2\u1ee4\u1ee6\u1ee8\u1eea\u1eec\u1eee\u1ef0\u1ef2\u1ef4\u1ef6\u1ef8\u1f08-\u1f0f\u1f18-\u1f1d\u1f28-\u1f2f\u1f38-\u1f3f\u1f48-\u1f4d\u1f59\u1f5b\u1f5d\u1f5f\u1f68-\u1f6f\u1fb8-\u1fbb\u1fc8-\u1fcb\u1fd8-\u1fdb\u1fe8-\u1fec\u1ff8-\u1ffb\u2102\u2107\u210b-\u210d\u2110-\u2112\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u2130-\u2133\u213e\u213f\u2145\u2183\u2c00-\u2c2e\u2c60\u2c62-\u2c64\u2c67\u2c69\u2c6b\u2c75\u2c80\u2c82\u2c84\u2c86\u2c88\u2c8a\u2c8c\u2c8e\u2c90\u2c92\u2c94\u2c96\u2c98\u2c9a\u2c9c\u2c9e\u2ca0\u2ca2\u2ca4\u2ca6\u2ca8\u2caa\u2cac\u2cae\u2cb0\u2cb2\u2cb4\u2cb6\u2cb8\u2cba\u2cbc\u2cbe\u2cc0\u2cc2\u2cc4\u2cc6\u2cc8\u2cca\u2ccc\u2cce\u2cd0\u2cd2\u2cd4\u2cd6\u2cd8\u2cda\u2cdc\u2cde\u2ce0\u2ce2\uff21-\uff3a]',
        Cs: '[\ud800\udb7f\udb80\udbff\udc00\udfff]',
        Zl: '[\u2028]',
        Nl: '[\u16ee-\u16f0\u2160-\u2182\u3007\u3021-\u3029\u3038-\u303a]',
        Zp: '[\u2029]',
        No: '[\u00b2\u00b3\u00b9\u00bc-\u00be\u09f4-\u09f9\u0bf0-\u0bf2\u0f2a-\u0f33\u1369-\u137c\u17f0-\u17f9\u2070\u2074-\u2079\u2080-\u2089\u2153-\u215f\u2460-\u249b\u24ea-\u24ff\u2776-\u2793\u2cfd\u3192-\u3195\u3220-\u3229\u3251-\u325f\u3280-\u3289\u32b1-\u32bf]',
        Zs: '[\u0020\u00a0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000]',
        Sc: '[\u0024\u00a2-\u00a5\u060b\u09f2\u09f3\u0af1\u0bf9\u0e3f\u17db\u20a0-\u20b5\ufdfc\ufe69\uff04\uffe0\uffe1\uffe5\uffe6]',
        Pc: '[\u005f\u203f\u2040\u2054\ufe33\ufe34\ufe4d-\ufe4f\uff3f]',
        Pd: '[\u002d\u058a\u1806\u2010-\u2015\u2e17\u301c\u3030\u30a0\ufe31\ufe32\ufe58\ufe63\uff0d]',
        Pe: '[\u0029\u005d\u007d\u0f3b\u0f3d\u169c\u2046\u207e\u208e\u232a\u2769\u276b\u276d\u276f\u2771\u2773\u2775\u27c6\u27e7\u27e9\u27eb\u2984\u2986\u2988\u298a\u298c\u298e\u2990\u2992\u2994\u2996\u2998\u29d9\u29db\u29fd\u3009\u300b\u300d\u300f\u3011\u3015\u3017\u3019\u301b\u301e\u301f\ufd3f\ufe18\ufe36\ufe38\ufe3a\ufe3c\ufe3e\ufe40\ufe42\ufe44\ufe48\ufe5a\ufe5c\ufe5e\uff09\uff3d\uff5d\uff60\uff63]',
        Pf: '[\u00bb\u2019\u201d\u203a\u2e03\u2e05\u2e0a\u2e0d\u2e1d]',
        Me: '[\u0488\u0489\u06de\u20dd-\u20e0\u20e2-\u20e4]',
        Mc: '[\u0903\u093e-\u0940\u0949-\u094c\u0982\u0983\u09be-\u09c0\u09c7\u09c8\u09cb\u09cc\u09d7\u0a03\u0a3e-\u0a40\u0a83\u0abe-\u0ac0\u0ac9\u0acb\u0acc\u0b02\u0b03\u0b3e\u0b40\u0b47\u0b48\u0b4b\u0b4c\u0b57\u0bbe\u0bbf\u0bc1\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcc\u0bd7\u0c01-\u0c03\u0c41-\u0c44\u0c82\u0c83\u0cbe\u0cc0-\u0cc4\u0cc7\u0cc8\u0cca\u0ccb\u0cd5\u0cd6\u0d02\u0d03\u0d3e-\u0d40\u0d46-\u0d48\u0d4a-\u0d4c\u0d57\u0d82\u0d83\u0dcf-\u0dd1\u0dd8-\u0ddf\u0df2\u0df3\u0f3e\u0f3f\u0f7f\u102c\u1031\u1038\u1056\u1057\u17b6\u17be-\u17c5\u17c7\u17c8\u1923-\u1926\u1929-\u192b\u1930\u1931\u1933-\u1938\u19b0-\u19c0\u19c8\u19c9\u1a19-\u1a1b\u1b04\u1b35\u1b3b\u1b3d-\u1b41\u1b43\u1b44\ua802\ua823\ua824\ua827]'
    };
    /* Also supports the general category (only the first letter) */
    var firstLetters = {};
    for (var p in unicodeCategories) {
        if (firstLetters[p[0]])
            firstLetters[p[0]] = unicodeCategories[p].substring(0, unicodeCategories[p].length - 1) + firstLetters[p[0]].substring(1);
        else
            firstLetters[p[0]] = unicodeCategories[p];
    }
    for (var p in firstLetters)
        unicodeCategories[p] = firstLetters[p];

    /* Gets a regex written in a dialect that supports unicode categories and
     translates it to a dialect supported by JavaScript. */
    return function(regexpString, classes) {
        var modifiers = "";
        if (regexpString instanceof RegExp) {
            modifiers = (regexpString.global ? "g" : "") + (regexpString.ignoreCase ? "i" : "") + (regexpString.multiline ? "m" : "");
            regexpString = regexpString.source;
        }
        regexpString = regexpString.replace(/\\p\{(..?)\}/g, function(match, group) {
            var unicode_categorie = unicodeCategories[group];
            if (!classes)
                unicode_category = unicode_categorie.replace(/\[(.*?)\]/g, "$1")
            return unicode_category || match;
        });
        return new RegExp(regexpString,modifiers);
    }
    ;

}
)();

</script>
{% endif %} 
<script type="text/javascript">
    var loggedIn="{{ logged }}";

    $('#shipping_address_id_custom').change(function() {
        shippingAddressLoad();
    });
    
    function shippingAddressLoad() {
        selected_address_id = $('#shipping-existing select[name="address_id"]').val(); 
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/get_customer_address&address_id='+selected_address_id+'&type=getAddress',
            type: 'get',
            success: function(data) { 
                var json_data = jQuery.parseJSON(data);
                $('#shipping_address_detail').html(json_data);
            }
        });
    }
    
    $('#payment_address_id_custom').change(function() {
        paymentAddressLoad();
    });
    
    function paymentAddressLoad() {
        selected_address_id = $('#payment-existing select[name="address_id"]').val(); 
        $.ajax({
            url: 'index.php?route=supercheckout/supercheckout/get_customer_address&address_id='+selected_address_id+'&type=getAddress',
            type: 'get',
            success: function(data) { 
                var json_data = jQuery.parseJSON(data);
                $('#payment_address_detail').html(json_data);
            }
        });
    }
    
    if(loggedIn != "") {
        paymentAddressLoad();
        shippingAddressLoad();
    }
</script>
{{ footer }} 
